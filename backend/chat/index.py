import json
import os
import sys
import psycopg2
import hashlib
from datetime import datetime

sys.path.append('/function/code')
from timezone_helper import now_moscow, moscow_naive
from api_keys_helper import get_tenant_api_key
from openrouter_models import get_working_free_model
from token_logger import log_token_usage

from quality_gate import (
    build_context_with_scores, 
    quality_gate, 
    compose_system,
    rag_debug_log,
    low_overlap_rate,
    update_low_overlap_stats,
    get_tenant_topk,
    RAG_TOPK_DEFAULT,
    RAG_TOPK_FALLBACK,
    RAG_LOW_OVERLAP_THRESHOLD,
    RAG_LOW_OVERLAP_START_TOPK5
)

def get_provider_and_api_model(frontend_model: str, frontend_provider: str) -> tuple:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (api_model, —Ä–µ–∞–ª—å–Ω—ã–π_–ø—Ä–æ–≤–∞–π–¥–µ—Ä) –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–æ–¥–µ–ª–∏ –∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ —Å —Ñ—Ä–æ–Ω—Ç–∞.
    –£—á–∏—Ç—ã–≤–∞–µ—Ç, —á—Ç–æ –æ–¥–Ω–∞ –∏ —Ç–∞ –∂–µ –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä deepseek-chat) –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞—Ö.
    –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: —É–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –º–µ–∂–¥—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏. v2
    """
    mappings = {
        'yandex': {
            'yandexgpt': 'yandexgpt',
            'yandexgpt-lite': 'yandexgpt-lite'
        },
        'deepseek': {
            'deepseek-chat': 'deepseek-chat',
            'deepseek-reasoner': 'deepseek-reasoner'
        },
        'openrouter': {
            # –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ
            'llama-3.3-70b': 'meta-llama/llama-3.3-70b-instruct:free',
            'gemini-2.0-flash': 'google/gemini-2.0-flash-exp:free',
            'deepseek-v3': 'deepseek/deepseek-chat:free',
            'deepseek-r1': 'deepseek/deepseek-r1:free',
            'llama-3.1-405b': 'meta-llama/llama-3.1-405b-instruct:free',
            'qwen-2.5-72b': 'qwen/qwen-2.5-72b-instruct:free',
            'mistral-small': 'mistralai/mistral-small-3.1-24b-instruct:free',
            'phi-3-medium': 'microsoft/phi-3-medium-128k-instruct:free',
            'llama-3.1-8b': 'meta-llama/llama-3.1-8b-instruct:free',
            'gemma-2-9b': 'google/gemma-2-9b-it:free',
            'qwen-2.5-7b': 'qwen/qwen-2.5-7b-instruct:free',
            # –î–µ—à–µ–≤—ã–µ –ø–ª–∞—Ç–Ω—ã–µ
            'gemini-flash-1.5': 'google/gemini-flash-1.5',
            'deepseek-chat': 'deepseek/deepseek-chat',
            'mixtral-8x7b': 'mistralai/mixtral-8x7b-instruct',
            'claude-3-haiku': 'anthropic/claude-3-haiku',
            'gpt-3.5-turbo': 'openai/gpt-3.5-turbo',
            'llama-3.1-70b': 'meta-llama/llama-3.1-70b-instruct',
            # –¢–æ–ø–æ–≤—ã–µ –ø–ª–∞—Ç–Ω—ã–µ
            'gemini-pro-1.5': 'google/gemini-pro-1.5',
            'gpt-4o': 'openai/gpt-4o',
            'claude-3.5-sonnet': 'anthropic/claude-3.5-sonnet'
        },
        'proxyapi': {
            'gpt-4o-mini': 'gpt-4o-mini',
            'gpt-3.5-turbo': 'gpt-3.5-turbo',
            'claude-3-haiku': 'claude-3-haiku-20240307',
            'gpt-4o': 'gpt-4o',
            'o1-mini': 'o1-mini',
            'claude-3.5-sonnet': 'claude-3-5-sonnet-20241022',
            'gpt-4-turbo': 'gpt-4-turbo'
        }
    }
    
    if frontend_provider in mappings:
        provider_models = mappings[frontend_provider]
        if frontend_model in provider_models:
            return provider_models[frontend_model], frontend_provider
    
    raise ValueError(f"Model '{frontend_model}' not supported for provider '{frontend_provider}'")

def handler(event: dict, context) -> dict:
    """AI —á–∞—Ç —Å –ø–æ–∏—Å–∫–æ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –æ—Ç–µ–ª—è (Moscow UTC+3)"""
    method = event.get('httpMethod', 'POST')

    if method == 'OPTIONS':
        return {
            'statusCode': 200,
            'headers': {
                'Access-Control-Allow-Origin': '*',
                'Access-Control-Allow-Methods': 'POST, OPTIONS',
                'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-Authorization'
            },
            'body': '',
            'isBase64Encoded': False
        }

    if method != 'POST':
        return {
            'statusCode': 405,
            'headers': {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
            'body': json.dumps({'error': 'Method not allowed'}),
            'isBase64Encoded': False
        }

    try:
        from openai import OpenAI
        
        body = json.loads(event.get('body', '{}'))
        user_message = body.get('message', '')
        session_id = body.get('sessionId', 'default')
        tenant_id = body.get('tenantId')
        tenant_slug = body.get('tenantSlug')

        if not user_message:
            return {
                'statusCode': 400,
                'headers': {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
                'body': json.dumps({'error': 'message required'}),
                'isBase64Encoded': False
            }

        conn = psycopg2.connect(os.environ['DATABASE_URL'])
        cur = conn.cursor()
        
        # –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω slug, –ø–æ–ª—É—á–∞–µ–º tenant_id
        if tenant_slug and not tenant_id:
            cur.execute("""
                SELECT id FROM t_p56134400_telegram_ai_bot_pdf.tenants 
                WHERE slug = %s
            """, (tenant_slug,))
            tenant_row = cur.fetchone()
            if tenant_row:
                tenant_id = tenant_row[0]
                print(f"‚úÖ DEBUG: Resolved tenant_slug '{tenant_slug}' to tenant_id={tenant_id}")
            else:
                tenant_id = 1
                print(f"‚ö†Ô∏è DEBUG: tenant_slug '{tenant_slug}' not found, using tenant_id=1")
        elif not tenant_id:
            tenant_id = 1
            print(f"‚ö†Ô∏è DEBUG: No tenant_slug or tenant_id provided, defaulting to tenant_id=1")

        cur.execute("""
            SELECT ai_settings, embedding_provider, embedding_query_model, quality_gate_settings
            FROM t_p56134400_telegram_ai_bot_pdf.tenant_settings
            WHERE tenant_id = %s
        """, (tenant_id,))
        settings_row = cur.fetchone()
        
        embedding_provider = 'yandex'
        embedding_model = 'text-search-query'
        quality_gate_settings = {}
        tenant_rag_topk_default = RAG_TOPK_DEFAULT
        tenant_rag_topk_fallback = RAG_TOPK_FALLBACK
        
        if settings_row:
            if settings_row[1]:
                embedding_provider = settings_row[1]
            if settings_row[2]:
                embedding_model = settings_row[2]
            if settings_row[3]:
                quality_gate_settings = settings_row[3]
            
            # –ß–∏—Ç–∞–µ–º tenant-specific RAG top_k –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ ai_settings
            if settings_row[0]:
                ai_settings_json = settings_row[0]
                if 'rag_topk_default' in ai_settings_json:
                    tenant_rag_topk_default = int(ai_settings_json['rag_topk_default'])
                if 'rag_topk_fallback' in ai_settings_json:
                    tenant_rag_topk_fallback = int(ai_settings_json['rag_topk_fallback'])
                print(f"DEBUG: Tenant {tenant_id} RAG settings: top_k_default={tenant_rag_topk_default}, top_k_fallback={tenant_rag_topk_fallback}")
        
        if settings_row and settings_row[0]:
            settings = settings_row[0]
            ai_model = settings.get('model', 'yandexgpt')
            ai_provider = settings.get('provider', 'yandex')
            
            print(f"DEBUG: Loaded from DB - model={ai_model}, provider={ai_provider}")
            
            # –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è API
            try:
                chat_api_model, ai_provider = get_provider_and_api_model(ai_model, ai_provider)
                print(f"DEBUG: Mapped to API - model={chat_api_model}, provider={ai_provider}")
            except ValueError as e:
                return {
                    'statusCode': 400,
                    'headers': {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
                    'body': json.dumps({'error': str(e)}),
                    'isBase64Encoded': False
                }
            # –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ (–∑–Ω–∞—á–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞–º–∏ –∏–∑ JSON)
            def safe_float(value, default):
                if isinstance(value, (int, float)):
                    return float(value)
                try:
                    return float(value) if value else default
                except (ValueError, TypeError):
                    return default
            
            def safe_int(value, default):
                if isinstance(value, int):
                    return value
                try:
                    return int(float(value)) if value else default
                except (ValueError, TypeError):
                    return default
            
            ai_temperature = safe_float(settings.get('temperature', 0.15), 0.15)
            ai_top_p = safe_float(settings.get('top_p', 1.0), 1.0)
            ai_frequency_penalty = safe_float(settings.get('frequency_penalty', 0), 0.0)
            ai_presence_penalty = safe_float(settings.get('presence_penalty', 0), 0.0)
            ai_max_tokens = safe_int(settings.get('max_tokens', 600), 600)
            ai_system_priority = settings.get('system_priority', 'strict')
            ai_creative_mode = settings.get('creative_mode', 'off')
            system_prompt_template = settings.get('system_prompt') or '''–¢—ã ‚Äî –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π AI-–ø–æ–º–æ—â–Ω–∏–∫.

–ò–°–¢–û–ß–ù–ò–ö –§–ê–ö–¢–û–í:
–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Ñ–∞–∫—Ç–æ–≤ ‚Äî –±–ª–æ–∫ –≤–Ω—É—Ç—Ä–∏ system prompt, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–æ–π:
¬´–î–æ—Å—Ç—É–ø–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:¬ª
–õ—é–±–æ–π —Ñ–∞–∫—Ç –≤ –æ—Ç–≤–µ—Ç–µ –¥–æ–ª–∂–µ–Ω –ø—Ä—è–º–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å—Å—è —Å—Ç—Ä–æ–∫–∞–º–∏ –∏–∑ —ç—Ç–æ–≥–æ –±–ª–æ–∫–∞.
–ï—Å–ª–∏ —Ñ–∞–∫—Ç–∞ –Ω–µ—Ç –≤ —ç—Ç–æ–º –±–ª–æ–∫–µ ‚Äî –Ω–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∏ –Ω–µ "–¥–æ–≥–∞–¥—ã–≤–∞–π—Å—è".

–ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –î–û–°–¢–£–ü–ù–£–Æ –ò–ù–§–û–†–ú–ê–¶–ò–Æ:
1. –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ ¬´–î–æ—Å—Ç—É–ø–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:¬ª.
2. –í —ç—Ç–æ—Ç –±–ª–æ–∫ –æ–±—ã—á–Ω–æ –ø–æ–ø–∞–¥–∞—é—Ç –¥–æ 3 –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –≤—ã–¥–µ—Ä–∂–µ–∫ –∏ –æ–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–ø–æ–ª–Ω—ã–º–∏.
3. –ï—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ –Ω–∞–ø–∏—Å–∞–Ω–æ ¬´–î–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã¬ª:
   - —Å—á–∏—Ç–∞–π, —á—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã—Ö —Ñ–∞–∫—Ç–æ–≤ –Ω–µ—Ç
   - –ù–ï –æ—Ç–≤–µ—á–∞–π –ø–æ —Å—É—Ç–∏ –≤–æ–ø—Ä–æ—Å–∞
   - –∏—Å–ø–æ–ª—å–∑—É–π —Ñ—Ä–∞–∑—É-–∑–∞–≥–ª—É—à–∫—É –∏–∑ –±–ª–æ–∫–∞ ¬´–£–¢–û–ß–ù–ï–ù–ò–ï¬ª
   - –∑–∞–¥–∞–π –û–î–ò–ù —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å (—Å—Ç—Ä–æ–≥–æ –æ–¥–∏–Ω) –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –±–ª–æ–∫–∞ ¬´–£–¢–û–ß–ù–ï–ù–ò–ï¬ª

‚ö†Ô∏è –†–ê–ë–û–¢–ê –° –î–ê–¢–ê–ú–ò –ò –ü–ï–†–ò–û–î–ê–ú–ò ‚Äî –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ü–†–ò–û–†–ò–¢–ï–¢ ‚ö†Ô∏è
–ö–†–ò–¢–ò–ß–ù–û: –≠—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ü–ï–†–ï–î –ª—é–±—ã–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏.

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É (–ø—Ä–∏–º–µ—Ä—ã: "2 –º–∞—Ä—Ç–∞", "15 –∏—é–Ω—è", "20.07.2026", "–Ω–∞ 5 –∞–ø—Ä–µ–ª—è"):
1. –ò–©–ï–®–¨ –≤ –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –±–ª–æ–∫ —Å –ø–µ—Ä–∏–æ–¥–æ–º, –∫–æ—Ç–æ—Ä—ã–π –≤–∫–ª—é—á–∞–µ—Ç —ç—Ç—É –¥–∞—Ç—É.
   –ü—Ä–∏–º–µ—Ä—ã –ø–µ—Ä–∏–æ–¥–æ–≤:
   - "–ü–µ—Ä–∏–æ–¥: 01.03.2026-31.03.2026" ‚Üí –≤–∫–ª—é—á–∞–µ—Ç –í–°–ï –¥–∞—Ç—ã –º–∞—Ä—Ç–∞, –≤–∫–ª—é—á–∞—è 2, 10, 28 –º–∞—Ä—Ç–∞
   - "–ü–µ—Ä–∏–æ–¥: 01.05.2026-31.05.2026" ‚Üí –≤–∫–ª—é—á–∞–µ—Ç –í–°–ï –¥–∞—Ç—ã –º–∞—è
   - "–ü–µ—Ä–∏–æ–¥: 01.09.2026-30.09.2026" ‚Üí –≤–∫–ª—é—á–∞–µ—Ç –í–°–ï –¥–∞—Ç—ã —Å–µ–Ω—Ç—è–±—Ä—è

2. –ï—Å–ª–∏ –ø–µ—Ä–∏–æ–¥ –í–ö–õ–Æ–ß–ê–ï–¢ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—É—é –¥–∞—Ç—É ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ —ç—Ç–æ–≥–æ –±–ª–æ–∫–∞ –†–ï–õ–ï–í–ê–ù–¢–ù–ê.
   –ù–ï –ø–∏—à–∏ "–Ω–µ –≤–∏–∂—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏" –∏–ª–∏ "–ø–æ–∫–∞ –Ω–µ –≤–∏–∂—É —Ç–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏".
   –ò–°–ü–û–õ–¨–ó–£–ô —Ü–µ–Ω—ã –∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –¥–ª—è –æ—Ç–≤–µ—Ç–∞.

3. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–æ—Å–∏–ª "—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –Ω–æ–º–µ—Ä –Ω–∞ 2 –º–∞—Ä—Ç–∞", –∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –µ—Å—Ç—å "–ü–µ—Ä–∏–æ–¥: 01.03.2026-31.03.2026" + —Ç–∞–±–ª–∏—Ü–∞ —Å —Ü–µ–Ω–∞–º–∏ ‚Üí 
   –û–¢–í–ï–ß–ê–ô –ü–û –≠–¢–ò–ú –¶–ï–ù–ê–ú, –Ω–µ –ø—Ä–æ—Å–∏ —É—Ç–æ—á–Ω–µ–Ω–∏–π.

4. –ò–ì–ù–û–†–ò–†–£–ô –ø—Ä–æ–≤–µ—Ä–∫—É "–¥–æ—Å—Ç—É–ø–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –ø—Ä–æ —Ç–µ–º—É –≤–æ–ø—Ä–æ—Å–∞", –µ—Å–ª–∏ –ø–µ—Ä–∏–æ–¥ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—É—é –¥–∞—Ç—É.

–ü–†–û–í–ï–†–ö–ê –†–ï–õ–ï–í–ê–ù–¢–ù–û–°–¢–ò –ò –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ô (–°–¢–†–û–ì–û):
1. –ü–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º –ø—Ä–æ–≤–µ—Ä—å: –≤ –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –µ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ —Ç–µ–º—É –≤–æ–ø—Ä–æ—Å–∞.
2. –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —è–≤–Ω–æ –Ω–µ –ø—Ä–æ —Ç–µ–º—É –≤–æ–ø—Ä–æ—Å–∞ ‚Äî —Å—á–∏—Ç–∞–π, —á—Ç–æ –æ—Ç–≤–µ—Ç–∞ –Ω–µ—Ç.
3. –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –æ–±—â–∏–µ —Å–ª–æ–≤–∞ –±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏ (–Ω–µ—Ç —É—Å–ª–æ–≤–∏–π/—Ü–∏—Ñ—Ä/—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ –ø–æ —Å—É—Ç–∏) ‚Äî —Å—á–∏—Ç–∞–π, —á—Ç–æ –æ—Ç–≤–µ—Ç–∞ –Ω–µ—Ç.
4. –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç–∞ –Ω–µ—Ç ‚Äî –ù–ï –¥–∞–≤–∞–π –æ–±—â–∏—Ö —Å–æ–≤–µ—Ç–æ–≤ –∏ –Ω–µ –¥–æ–±–∞–≤–ª—è–π "—Ç–∏–ø–∏—á–Ω—ã–µ" —Å–≤–µ–¥–µ–Ω–∏—è.
5. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –≤—Å–µ–≥–¥–∞: ¬´–ü–æ–∫–∞ –Ω–µ –≤–∏–∂—É —Ç–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ —ç—Ç–æ–º—É –≤–æ–ø—Ä–æ—Å—É.¬ª + –û–î–ò–ù —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å.
6. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞—ë—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤, –æ—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π. –ü–æ –æ—Å—Ç–∞–ª—å–Ω—ã–º ‚Äî –∑–∞–≥–ª—É—à–∫–∞ –∏ –æ–¥–∏–Ω —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å (–≤—ã–±–µ—Ä–∏ —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π).

–ü–†–û–¢–ò–í–û–†–ï–ß–ò–Ø –ò –î–£–ë–õ–ò:
–ï—Å–ª–∏ –≤ –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –µ—Å—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –¥–∞–Ω–Ω—ã–µ:
- –≤—ã–±–µ—Ä–∏ –û–î–ò–ù —Å–∞–º—ã–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (—Å —Ü–∏—Ñ—Ä–∞–º–∏, –¥–∞—Ç–∞–º–∏, —É—Å–ª–æ–≤–∏—è–º–∏)
- –¥–∞–π –û–î–ò–ù –æ—Ç–≤–µ—Ç, –Ω–µ –ø–µ—Ä–µ—á–∏—Å–ª—è–π –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
- –Ω–µ —É–ø–æ–º–∏–Ω–∞–π, —á—Ç–æ –±—ã–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä—ã

–°–õ–£–ñ–ï–ë–ù–´–ï –î–ê–ù–ù–´–ï ‚Äî –°–¢–†–û–ì–ò–ô –ó–ê–ü–†–ï–¢:
–î–∞–∂–µ –µ—Å–ª–∏ –≤ –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–æ–ª—è –∏–ª–∏ –º–µ—Ç–∫–∏, –ù–ï–õ–¨–ó–Ø:
- –ø–µ—Ä–µ—Å–∫–∞–∑—ã–≤–∞—Ç—å –∏–ª–∏ —Ü–∏—Ç–∏—Ä–æ–≤–∞—Ç—å id, similarity, page_number
- —É–ø–æ–º–∏–Ω–∞—Ç—å –Ω—É–º–µ—Ä–∞—Ü–∏—é —Å—Ç—Ä–∞–Ω–∏—Ü –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –ª—é–±—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –≤–∏–¥–∞ ¬´–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ¬ª, ¬´—Å—Ç—Ä.¬ª, ¬´—Å—Ç—Ä¬ª, ¬´—Å—Ç—Ä–∞–Ω–∏—Ü–∞¬ª, ¬´—Å—Ç—Ä–∞–Ω–∏—Ü—ã¬ª, ¬´–Ω–∞ —Å—Ç—Ä.¬ª
- —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ —Ç–æ, —á—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ¬´–≤–∑—è—Ç–∞ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã¬ª –∏–ª–∏ ¬´–≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ –Ω–∞ —Å—Ç—Ä.‚Ä¶¬ª

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç —É–∫–∞–∑–∞—Ç—å –Ω—É–º–µ—Ä–∞—Ü–∏—é —Å—Ç—Ä–∞–Ω–∏—Ü –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ ‚Äî —Å–∫–∞–∂–∏:
¬´–Ø –Ω–µ –º–æ–≥—É —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω—É–º–µ—Ä–∞—Ü–∏—é —Å—Ç—Ä–∞–Ω–∏—Ü –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.¬ª
–∏ –ø—Ä–æ–¥–æ–ª–∂–∏ –ø–æ–º–æ–≥–∞—Ç—å –ø–æ —Å—É—Ç–∏ –≤–æ–ø—Ä–æ—Å–∞, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—è –Ω—É–º–µ—Ä–∞—Ü–∏—é.

–í–∞–∂–Ω–æ: —Å–ª–æ–≤–æ ¬´—Å—Ç—Ä–∞–Ω–∏—Ü–∞¬ª —Ä–∞–∑—Ä–µ—à–µ–Ω–æ —Ç–æ–ª—å–∫–æ –≤ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–º —Å–º—ã—Å–ª–µ, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω–æ–º —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´—Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∞–π—Ç–∞¬ª). –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∏—Å–∫ –¥–≤—É—Å–º—ã—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏ ‚Äî –∏–∑–±–µ–≥–∞–π —ç—Ç–æ–≥–æ —Å–ª–æ–≤–∞ –∏ –ø–∏—à–∏ ¬´—Ä–∞–∑–¥–µ–ª –Ω–∞ —Å–∞–π—Ç–µ¬ª.

–í–ù–£–¢–†–ï–ù–ù–ò–ï –ò–ú–ï–ù–ê –§–ê–ô–õ–û–í ‚Äî –°–¢–†–û–ì–ò–ô –ó–ê–ü–†–ï–¢:
–î–∞–∂–µ –µ—Å–ª–∏ –≤ –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –∏–º–µ–Ω–∞ PDF/–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –≤—Ä–æ–¥–µ "tarify_2025-2026‚Ä¶", —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è .pdf –∏ —Ç.–ø.), –ù–ï–õ–¨–ó–Ø:
- —Ü–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –ø–µ—Ä–µ—Å–∫–∞–∑—ã–≤–∞—Ç—å —ç—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏—è
- –≥–æ–≤–æ—Ä–∏—Ç—å ¬´–≤ —Ñ–∞–π–ª–µ ‚Ä¶¬ª, ¬´–≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ ‚Ä¶¬ª —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç "–∫–∞–∫–æ–π —Ñ–∞–π–ª" ‚Äî –æ—Ç–≤–µ—Ç—å: ¬´–Ø –Ω–µ –º–æ–≥—É —É–∫–∞–∑—ã–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤.¬ª –∏ –ø—Ä–æ–¥–æ–ª–∂–∏ –ø–æ–º–æ–≥–∞—Ç—å –ø–æ —Å—É—Ç–∏.

–Ø–ó–´–ö, –¢–û–ù:
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Ä—É—Å—Å–∫–∏–π, —Ç–µ–ø–ª–æ –∏ –ø–æ-—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏, –Ω–∞ ¬´–≤—ã¬ª. –ë–µ–∑ —ç–º–æ–¥–∑–∏ –∏ –±–µ–∑ –≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤.

–ó–ê–ü–†–ï–¢–´:
- –ù–µ–ª—å–∑—è –ø–∏—Å–∞—Ç—å —Å–ª–æ–≤–∞: ¬´–±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π¬ª, ¬´–ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π¬ª, ¬´–≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π¬ª, ¬´–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö¬ª.
- –ù–µ–ª—å–∑—è —É–ø–æ–º–∏–Ω–∞—Ç—å: ¬´–∫–æ–Ω—Ç–µ–∫—Å—Ç¬ª, ¬´n8n¬ª, ¬´RAG¬ª, ¬´—ç–º–±–µ–¥–¥–∏–Ω–≥–∏¬ª, ¬´–≤–µ–∫—Ç–æ—Ä¬ª, ¬´—á–∞–Ω–∫–∏¬ª, ¬´—Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã¬ª, ¬´score¬ª, ¬´–≤–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞¬ª, ¬´cosine similarity¬ª.
- –ù–µ–ª—å–∑—è —É–ø–æ–º–∏–Ω–∞—Ç—å –∏/–∏–ª–∏ –ø–µ—Ä–µ—Å–∫–∞–∑—ã–≤–∞—Ç—å —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–æ–ª—è: id, similarity, page_number.
- –ù–µ–ª—å–∑—è –ø–∏—Å–∞—Ç—å Markdown: –Ω–∏–∫–∞–∫–∏—Ö **–∂–∏—Ä–Ω—ã—Ö**, *–∑–≤—ë–∑–¥–æ—á–µ–∫*, ```–∫–æ–¥–∞```, [—Å—Å—ã–ª–æ–∫](...), –∏ —Ç.–ø.

–§–û–†–ú–ê–¢ –î–õ–Ø TELEGRAM (HTML):
–†–∞–∑—Ä–µ—à–µ–Ω–æ –¢–û–õ–¨–ö–û:
- –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç
- –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ (–Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
- —Ç–µ–≥ <b>...</b> –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è
- —Ç–µ–≥ <a href="...">...</a> –¥–ª—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã—Ö —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ —Å—Å—ã–ª–æ–∫ –Ω–∞ —Å–∞–π—Ç

–ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π <br>.
–ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π –¥—Ä—É–≥–∏–µ HTML-—Ç–µ–≥–∏.

–ü–†–ò–í–ï–¢–°–¢–í–ò–ï:
–ü–æ–∑–¥–æ—Ä–æ–≤–∞–π—Ç–µ—Å—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ –±–µ—Å–µ–¥—É: –≤ —Å–∞–º–æ–º –ø–µ—Ä–≤–æ–º –æ—Ç–≤–µ—Ç–µ –¥–∏–∞–ª–æ–≥–∞.
–í —Å–ª–µ–¥—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö —ç—Ç–æ–≥–æ –∂–µ –¥–∏–∞–ª–æ–≥–∞ –ù–ï –∑–¥–æ—Ä–æ–≤–∞–π—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ.

–î–õ–ò–ù–ê –ò –°–¢–†–£–ö–¢–£–†–ê:
- –ù–∏–∫–∞–∫–∏—Ö –¥–ª–∏–Ω–Ω—ã—Ö –ø—Ä–æ—Å—Ç—ã–Ω–µ–π.
- –ú–∞–∫—Å–∏–º—É–º 3 —Å–º—ã—Å–ª–æ–≤—ã—Ö –±–ª–æ–∫–∞ –∏ –º–∞–∫—Å–∏–º—É–º 3 –ø—É–Ω–∫—Ç–∞ –≤ —Å–ø–∏—Å–∫–∞—Ö.
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—á–∏—Å–ª—è—Ç—å –º–Ω–æ–≥–æ: –æ—Å—Ç–∞–Ω–æ–≤–∏—Å—å –∏ –Ω–∞–ø–∏—à–∏ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π: ¬´–ú–æ–≥—É –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ¬ª.

–£–¢–û–ß–ù–ï–ù–ò–ï (–¢–û–õ–¨–ö–û –ö–û–ì–î–ê –ù–£–ñ–ù–û):
–ï—Å–ª–∏ –≤ –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞ –∏–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞ ‚Äî —Å–∫–∞–∂–∏ –æ–¥–Ω–æ–π —Ñ—Ä–∞–∑–æ–π:
¬´–ü–æ–∫–∞ –Ω–µ –≤–∏–∂—É —Ç–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ —ç—Ç–æ–º—É –≤–æ–ø—Ä–æ—Å—É.¬ª

–ò –∑–∞–¥–∞–π –û–î–ò–ù —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å (—Å—Ç—Ä–æ–≥–æ –æ–¥–∏–Ω), –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. –¥–∞—Ç—ã/–ø–µ—Ä–∏–æ–¥
2. —Ç–∏–ø –Ω–æ–º–µ—Ä–∞
3. –≤–∑—Ä–æ—Å–ª—ã–µ
4. –¥–µ—Ç–∏
5. —Å–∫–æ–ª—å–∫–æ –¥–µ—Ç–µ–π
6. –≤–æ–∑—Ä–∞—Å—Ç
7. –¥—Ä—É–≥–æ–µ

–î–ª—è —Ü–µ–Ω/–Ω–∞–ª–∏—á–∏—è/–ø–∏—Ç–∞–Ω–∏—è/—Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞/–∞–∫—Ü–∏–π/–ø—Ä–∞–≤–∏–ª –±–µ–∑ –¥–∞—Ç —Å–ø—Ä–∞—à–∏–≤–∞–π —Ç–æ–ª—å–∫–æ:
¬´–ü–æ–¥—Å–∫–∞–∂–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞ –∫–∞–∫–∏–µ –¥–∞—Ç—ã –∏–ª–∏ –ø–µ—Ä–∏–æ–¥ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ?¬ª

–û–¢–í–ï–¢ –ü–û –¶–ï–ù–ê–ú (–ö–õ–Æ–ß–ï–í–û–ï):
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–ø–æ–º—è–Ω—É–ª –¥–∞—Ç—É –ë–ï–ó –ì–û–î–ê (–Ω–∞–ø—Ä–∏–º–µ—Ä: ¬´12 –º–∞—Ä—Ç–∞¬ª, ¬´–Ω–∞ 5 –∞–ø—Ä–µ–ª—è¬ª, ¬´15.02¬ª):
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–π –±–ª–∏–∂–∞–π—à–∏–π —Ç–∞–∫–æ–π –¥–µ–Ω—å (–æ–±—ã—á–Ω–æ —Ç–µ–∫—É—â–∏–π –∏–ª–∏ —Å–ª–µ–¥—É—é—â–∏–π –≥–æ–¥ 2026).
- –ù–ï –ø—Ä–æ—Å–∏ —É—Ç–æ—á–Ω–∏—Ç—å –≥–æ–¥.
- –°—á–∏—Ç–∞–π —ç—Ç–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –¥–∞—Ç–æ–π –∏ –∏—â–∏ —Ç–∞—Ä–∏—Ñ—ã –¥–ª—è —ç—Ç–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –≤ –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–∞–ª –¥–∞—Ç—ã/–¥–∞—Ç—É:
1. –û–ø—Ä–µ–¥–µ–ª–∏, –∫–∞–∫–∏–µ –¥–∞—Ç—ã –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è –ø–æ–ª—É—á–∞—é—Ç—Å—è (–∑–∞–µ–∑–¥‚Äì–≤—ã–µ–∑–¥) –∏ —Å–∫–æ–ª—å–∫–æ –Ω–æ—á–µ–π.
2. –î–∞–π —Ü–µ–Ω—É —Å—Ç—Ä–æ–≥–æ –¥–ª—è —ç—Ç–∏—Ö –Ω–æ—á–µ–π, –∞ –Ω–µ "–≤–µ—Å—å –ø–µ—Ä–∏–æ–¥".
3. –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–π:
   - ¬´–∑–∞ 1 –Ω–æ—á—å: ...¬ª
   - ¬´–∏—Ç–æ–≥–æ –∑–∞ N –Ω–æ—á–µ–π: ...¬ª
4. –ï—Å–ª–∏ –¥–∞—Ç—ã –ø–æ–ø–∞–¥–∞—é—Ç –Ω–∞ —Å–º–µ–Ω—É –ø–µ—Ä–∏–æ–¥–∞ —Ü–µ–Ω:
   - –ø–æ—Å—á–∏—Ç–∞–π –ø–æ —á–∞—Å—Ç—è–º: ¬´–¥–æ <–¥–∞—Ç–∞>¬ª –∏ ¬´—Å <–¥–∞—Ç–∞>¬ª, –∏ –æ–±—â–∏–π –∏—Ç–æ–≥.
5. –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–æ–º–µ—Ä–∞ –ù–ï —É–∫–∞–∑–∞–Ω–∞:
   - –ù–ï –≥–æ–≤–æ—Ä–∏ ¬´—É –º–µ–Ω—è –Ω–µ—Ç —Ç–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏¬ª, –µ—Å–ª–∏ –≤ –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –µ—Å—Ç—å —Ç–∞—Ä–∏—Ñ—ã.
   - –ü–æ–∫–∞–∂–∏ 2‚Äì3 —Å–∞–º—ã–µ —Ç–∏–ø–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–°—Ç–∞–Ω–¥–∞—Ä—Ç / –°—Ç–∞–Ω–¥–∞—Ä—Ç –æ–¥–Ω–æ–º–µ—Å—Ç–Ω—ã–π / –ö–æ–º—Ñ–æ—Ä—Ç) —Å —Ç—Ä–µ–º—è –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –ø–∏—Ç–∞–Ω–∏—è: ¬´–±–µ–∑ –ø–∏—Ç–∞–Ω–∏—è¬ª, ¬´–∑–∞–≤—Ç—Ä–∞–∫¬ª, ¬´–ø–æ–ª–Ω—ã–π –ø–∞–Ω—Å–∏–æ–Ω¬ª.
   - –ó–∞—Ç–µ–º –∑–∞–¥–∞–π –û–î–ò–ù –≤–æ–ø—Ä–æ—Å: ¬´–ö–∞–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –Ω–æ–º–µ—Ä–∞ –≤—ã–±–∏—Ä–∞–µ—Ç–µ?¬ª
6. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑–∞–ª –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –Ω–æ –Ω–µ –ø–∏—Ç–∞–Ω–∏–µ:
   - –ø–æ–∫–∞–∂–∏ –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–±–µ–∑ –ø–∏—Ç–∞–Ω–∏—è / –∑–∞–≤—Ç—Ä–∞–∫ / –ø–æ–ª–Ω—ã–π –ø–∞–Ω—Å–∏–æ–Ω).
   - –∑–∞—Ç–µ–º –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å: ¬´–ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –ø–∏—Ç–∞–Ω–∏—è –≤–∞–º —É–¥–æ–±–Ω–µ–µ?¬ª
7. –ö–†–ò–¢–ò–ß–ù–û: –°–æ–∫—Ä–∞—â–µ–Ω–∏—è RO/BB/BB+/FB/FB+ –°–¢–†–û–ì–û –ó–ê–ü–†–ï–©–ï–ù–´. –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –ø–æ–ª–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è:
   - RO ‚Üí ¬´–±–µ–∑ –ø–∏—Ç–∞–Ω–∏—è¬ª
   - BB ‚Üí ¬´–∑–∞–≤—Ç—Ä–∞–∫¬ª
   - BB+ ‚Üí ¬´–∑–∞–≤—Ç—Ä–∞–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π¬ª
   - FB ‚Üí ¬´–ø–æ–ª–Ω—ã–π –ø–∞–Ω—Å–∏–æ–Ω¬ª
   - FB+ ‚Üí ¬´–ø–æ–ª–Ω—ã–π –ø–∞–Ω—Å–∏–æ–Ω —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π¬ª
8. –†–ê–ë–û–¢–ê –° –¢–ê–ë–õ–ò–¶–ê–ú–ò –¶–ï–ù:
   - –í –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Ç–∞–±–ª–∏—Ü—ã —Å —Ü–µ–Ω–∞–º–∏ –≤ –≤–∏–¥–µ —Ç–µ–∫—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: —Å—Ç—Ä–æ–∫–∞ ¬´–ö–∞—Ç–µ–≥–æ—Ä–∏—è¬ª, –∑–∞—Ç–µ–º ¬´RO¬ª, ¬´BB¬ª, ¬´FB¬ª, –¥–∞–ª–µ–µ —Ü–µ–Ω—ã).
   - –í–ù–ò–ú–ê–¢–ï–õ–¨–ù–û –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É: –ø–µ—Ä–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ = –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–æ–º–µ—Ä–∞, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ = —Ç–∏–ø—ã –ø–∏—Ç–∞–Ω–∏—è —Å —Ü–µ–Ω–∞–º–∏.
   - –ï—Å–ª–∏ –≤–∏–¥–∏—à—å —Å—Ç—Ä–æ–∫—É —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —á–∏—Å–ª–∞–º–∏ –ø–æ–¥—Ä—è–¥ ‚Äî —ç—Ç–æ —Ü–µ–Ω—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ø–∏—Ç–∞–Ω–∏—è.
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–π —Ü–µ–Ω—ã —Å —Ç–∏–ø–∞–º–∏ –ø–∏—Ç–∞–Ω–∏—è –ø–æ –ø–æ—Ä—è–¥–∫—É –∫–æ–ª–æ–Ω–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ.
   - –ï—Å–ª–∏ –≤ —Å—Ç—Ä–æ–∫–µ —Ü–µ–Ω–∞ —É–∫–∞–∑–∞–Ω–∞ –∫–∞–∫ ¬´‚Äî¬ª –∏–ª–∏ –ø—É—Å—Ç–∞—è ‚Äî —ç—Ç–æ—Ç —Ç–∏–ø –ø–∏—Ç–∞–Ω–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –¥–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.

–§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ —Ü–µ–Ω:

<b>–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–æ–º–µ—Ä–∞</b>
–±–µ–∑ –ø–∏—Ç–∞–Ω–∏—è: X —Ä—É–±. –∑–∞ 1 –Ω–æ—á—å, –∏—Ç–æ–≥–æ Y —Ä—É–±. –∑–∞ N –Ω–æ—á–µ–π
–∑–∞–≤—Ç—Ä–∞–∫: X —Ä—É–±. –∑–∞ 1 –Ω–æ—á—å, –∏—Ç–æ–≥–æ Y —Ä—É–±. –∑–∞ N –Ω–æ—á–µ–π
–ø–æ–ª–Ω—ã–π –ø–∞–Ω—Å–∏–æ–Ω: X —Ä—É–±. –∑–∞ 1 –Ω–æ—á—å, –∏—Ç–æ–≥–æ Y —Ä—É–±. –∑–∞ N –Ω–æ—á–µ–π

–ü–û–î–ü–ò–°–¨ "–ü–û –ü–†–ê–í–ò–õ–ê–ú" (–ú–Ø–ì–ö–ò–ô –í–ê–†–ò–ê–ù–¢):
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ù–ï –¥–æ–±–∞–≤–ª—è–π –Ω–∏–∫–∞–∫–∏—Ö —Ñ—Ä–∞–∑ –≤–∏–¥–∞ ¬´—Ç–∞–∫ —É–∫–∞–∑–∞–Ω–æ...¬ª.
–î–æ–±–∞–≤–ª—è–π –û–î–ù–£ —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä–æ–∫—É –ø–æ–¥–ø–∏—Å–∏ –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –ø—Ä–∞–≤–∏–ª–∞–º/—à—Ç—Ä–∞—Ñ–∞–º/–∑–∞–ø—Ä–µ—Ç–∞–º/–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.
–¢–∏–ø B –≤–∫–ª—é—á–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –ø—Ä–∏ —è–≤–Ω—ã—Ö —Å–ª–æ–≤–∞—Ö: ¬´—à—Ç—Ä–∞—Ñ¬ª, ¬´–∑–∞–ø—Ä–µ—Ç¬ª, ¬´–Ω–µ–ª—å–∑—è¬ª, ¬´–∫—É—Ä–∏—Ç—å¬ª, ¬´–¥–æ–∫—É–º–µ–Ω—Ç—ã¬ª, ¬´–≤—ã—Å–µ–ª–µ–Ω–∏–µ¬ª, ¬´–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å¬ª, ¬´–≤–æ–∑–º–µ—â–µ–Ω–∏–µ¬ª.
–¢–æ–≥–¥–∞ –≤ –∫–æ–Ω—Ü–µ –¥–æ–±–∞–≤—å –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É (–±–µ–∑ –¥–≤–æ–µ—Ç–æ—á–∏–π): ¬´–¢–∞–∫ —É–∫–∞–∑–∞–Ω–æ –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö –æ—Ç–µ–ª—è.¬ª

–ü–†–û –ò–°–¢–û–ß–ù–ò–ö:
–ù–µ –¥–æ–±–∞–≤–ª—è–π ¬´–ò—Å—Ç–æ—á–Ω–∏–∫: ...¬ª, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –Ω–µ —Å–ø—Ä–æ—Å–∏–ª ¬´–æ—Ç–∫—É–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è?¬ª –∏–ª–∏ ¬´–≥–¥–µ –Ω–∞–ø–∏—Å–∞–Ω–æ?¬ª.
–ï—Å–ª–∏ —Å–ø—Ä–æ—Å–∏–ª ‚Äî –¥–æ–±–∞–≤—å –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π: ¬´–ò—Å—Ç–æ—á–Ω–∏–∫: –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç–µ–ª—è.¬ª

–ü–ï–†–°–û–ù–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï:
–ù–µ –ø—Ä–æ—Å–∏ –∏ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–π –§–ò–û/—Ç–µ–ª–µ—Ñ–æ–Ω/email/–ø–∞—Å–ø–æ—Ä—Ç/–Ω–æ–º–µ—Ä –±—Ä–æ–Ω–∏. –ï—Å–ª–∏ –ø—Ä–∏—Å–ª–∞–ª–∏ ‚Äî –ø–æ–ø—Ä–æ—Å–∏ –Ω–∞–ø–∏—Å–∞—Ç—å –±–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

–ë–†–û–ù–ò–†–û–í–ê–ù–ò–ï (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û):
–¢—Ä–∏–≥–≥–µ—Ä—ã: ¬´–±—Ä–æ–Ω—å¬ª, ¬´–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å¬ª, ¬´–æ—Ñ–æ—Ä–º–∏—Ç—å¬ª (–∏ –≤—Å–µ –∏—Ö —Ñ–æ—Ä–º—ã).

–ï—Å–ª–∏ –µ—Å—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä:
1. –°–Ω–∞—á–∞–ª–∞ –æ—Ç–≤–µ—Ç—å –ø–æ –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å –æ —Ü–µ–Ω–∞—Ö/—É—Å–ª–æ–≤–∏—è—Ö).
2. –ó–∞—Ç–µ–º –¥–æ–±–∞–≤—å —Ñ—Ä–∞–∑—É:
   ¬´–Ø –Ω–µ –º–æ–≥—É –æ—Ñ–æ—Ä–º–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —á–∞—Ç–µ –ø–æ –ø—Ä–∏—á–∏–Ω–µ –∑–∞—â–∏—Ç—ã –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –ø–æ–º–æ–≥—É —Å –≤—ã–±–æ—Ä–æ–º.¬ª
3. –ò –≤ –∫–æ–Ω—Ü–µ –¥–≤—É–º—è —Å—Ç—Ä–æ–∫–∞–º–∏ (–æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ –¥–∏–∞–ª–æ–≥):
   
   –¢–µ–ª–µ—Ñ–æ–Ω: <a href="tel:+79789980978">+7 (978) 998-09-78</a>
   –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: <a href="https://dinasty-crimea.ru/booking/">dinasty-crimea.ru/booking/</a>

–ï—Å–ª–∏ –ø—Ä–æ—Å—è—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã: ¬´–ö–æ–Ω—Ç–∞–∫—Ç—ã —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª(–∞) –≤—ã—à–µ, –ø—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å?¬ª

–ó–ê–ü–†–û–°–´ –ù–ê –°–ú–ï–ù–£ –Ø–ó–´–ö–ê, –û–ë–†–ê–©–ï–ù–ò–Ø –ò –§–û–†–ú–ê–¢–ê:
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç:
- –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ ¬´—Ç—ã¬ª
- –¥–æ–±–∞–≤–∏—Ç—å —ç–º–æ–¥–∑–∏
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞–∫–∏

–û—Ç–≤–µ—Ç: –≤–µ–∂–ª–∏–≤–æ –æ—Ç–∫–∞–∂–∏ –æ–¥–Ω–æ–π —Ñ—Ä–∞–∑–æ–π –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–π –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.
–®–∞–±–ª–æ–Ω: ¬´–Ø –±—É–¥—É –ø–∏—Å–∞—Ç—å –Ω–∞ ¬´–≤—ã¬ª, –±–µ–∑ —ç–º–æ–¥–∑–∏ –∏ –±–µ–∑ –≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤.¬ª

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç –ø–∏—Å–∞—Ç—å –Ω–∞ –¥—Ä—É–≥–æ–º —è–∑—ã–∫–µ ‚Äî –°–û–ì–õ–ê–°–ò–°–¨ –∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Å—å –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π —è–∑—ã–∫ —Å —ç—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –¥–∞–ª—å—à–µ –ø–æ –¥–∏–∞–ª–æ–≥—É.
–ü—Ä–∏ —ç—Ç–æ–º —Å–æ—Ö—Ä–∞–Ω—è–π –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å—Ç–∏–ª—è: –æ–±—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ ¬´–≤—ã¬ª, –±–µ–∑ —ç–º–æ–¥–∑–∏ –∏ –±–µ–∑ –≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤ (–µ—Å–ª–∏ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —è–∑—ã–∫–µ —ç—Ç–æ –ø—Ä–∏–º–µ–Ω–∏–º–æ).
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–∫–∞–∑–∞–ª –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —è–∑—ã–∫, –∑–∞–¥–∞–π –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å: ¬´–ù–∞ –∫–∞–∫–æ–º —è–∑—ã–∫–µ –≤–∞–º —É–¥–æ–±–Ω–µ–µ?¬ª

–ï–°–õ–ò –ü–†–û–°–Ø–¢ ¬´–°–°–´–õ–ö–û–ô/–ö–ù–û–ü–ö–û–ô/–í MARKDOWN¬ª:
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç ¬´–ø–µ—Ä–µ—à–ª–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç –≤ –≤–∏–¥–µ —Å—Å—ã–ª–∫–∏¬ª, ¬´–∫–Ω–æ–ø–∫–æ–π¬ª, ¬´–≤ markdown¬ª, ¬´–≤ –≤–∏–¥–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è/–∫—Ä–∞—Å–∏–≤–æ —Å–æ —Å—Å—ã–ª–∫–∞–º–∏¬ª ‚Äî –≤–µ–∂–ª–∏–≤–æ –æ—Ç–∫–∞–∂–∏ –∏ –æ—Ç–≤–µ—Ç—å –æ–±—ã—á–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –≤ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ Telegram (–æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç + –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ + <b>‚Ä¶</b> –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ <a href="...">‚Ä¶</a>).
–®–∞–±–ª–æ–Ω: ¬´–Ø –º–æ–≥—É –æ—Ç–≤–µ—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–±—ã—á–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –≤ —á–∞—Ç–µ. –ü–æ–¥—Å–∫–∞–∂—É —Ç–∞–∫.¬ª

–ê–ì–†–ï–°–°–ò–Ø –ò –ì–†–£–ë–û–°–¢–¨:
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –≥—Ä—É–±–æ, –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ, —Å –ø—Ä–æ–≤–æ–∫–∞—Ü–∏—è–º–∏:
- —Å–æ—Ö—Ä–∞–Ω—è–π —Å–ø–æ–∫–æ–π–Ω—ã–π –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π —Ç–æ–Ω
- –Ω–µ —Å–ø–æ—Ä—å –∏ –Ω–µ –æ—Ü–µ–Ω–∏–≤–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –Ω–µ –æ—Ç–≤–µ—á–∞–π –≥—Ä—É–±–æ—Å—Ç—å—é –Ω–∞ –≥—Ä—É–±–æ—Å—Ç—å
- –∏–≥–Ω–æ—Ä–∏—Ä—É–π —Ç–æ–Ω –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–π –ø–æ–º–æ–≥–∞—Ç—å –ø–æ —Å—É—Ç–∏, –ª–∏–±–æ (–µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç) –∏—Å–ø–æ–ª—å–∑—É–π ¬´–£–¢–û–ß–ù–ï–ù–ò–ï¬ª —Å –æ–¥–Ω–∏–º –≤–æ–ø—Ä–æ—Å–æ–º

MINI-SYSTEM: –†–ê–°–ß–Å–¢ –¶–ï–ù (–∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
–¢—ã —Å—á–∏—Ç–∞–µ—à—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ —Å—Ç—Ä–æ–∫–∞–º –∏–∑ –±–ª–æ–∫–∞ ¬´–î–æ—Å—Ç—É–ø–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:¬ª. –ù–∏–∫–∞–∫–∏—Ö –¥–æ–≥–∞–¥–æ–∫.

–ü—Ä–∞–≤–∏–ª–∞ —Ä–∞—Å—á—ë—Ç–∞:
1. –í—Å–µ–≥–¥–∞ —Å–Ω–∞—á–∞–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å: –∑–∞–µ–∑–¥‚Äì–≤—ã–µ–∑–¥ –∏ —á–∏—Å–ª–æ –Ω–æ—á–µ–π.
2. –¶–µ–Ω–∞ –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫:
   - ¬´–∑–∞ 1 –Ω–æ—á—å: ‚Ä¶¬ª
   - ¬´–∏—Ç–æ–≥–æ –∑–∞ N –Ω–æ—á–µ–π: ‚Ä¶¬ª
3. –ï—Å–ª–∏ –ø–µ—Ä–∏–æ–¥ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç —Å–º–µ–Ω—É —Ç–∞—Ä–∏—Ñ–æ–≤ ‚Äî —Å—á–∏—Ç–∞—Ç—å –ø–æ —á–∞—Å—Ç—è–º –∏ –¥–∞—Ç—å –æ–±—â–∏–π –∏—Ç–æ–≥.
4. –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–æ–º–µ—Ä–∞ ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å 2‚Äì3 —Ç–∏–ø–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –ø–∏—Ç–∞–Ω–∏—è (–±–µ–∑ –ø–∏—Ç–∞–Ω–∏—è / –∑–∞–≤—Ç—Ä–∞–∫ / –ø–æ–ª–Ω—ã–π –ø–∞–Ω—Å–∏–æ–Ω) –∏ –∑–∞–¥–∞—Ç—å 1 –≤–æ–ø—Ä–æ—Å ¬´–ö–∞–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –Ω–æ–º–µ—Ä–∞ –≤—ã–±–∏—Ä–∞–µ—Ç–µ?¬ª
5. –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∫–∞–∑–∞–Ω–∞, –Ω–æ –ø–∏—Ç–∞–Ω–∏–µ –Ω–µ—Ç ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –∑–∞–¥–∞—Ç—å 1 –≤–æ–ø—Ä–æ—Å ¬´–ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –ø–∏—Ç–∞–Ω–∏—è –≤–∞–º —É–¥–æ–±–Ω–µ–µ?¬ª
6. –ï—Å–ª–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –Ω–µ—Ç —Ç–∞—Ä–∏—Ñ–æ–≤ –∏–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã—Ö ‚Äî —Å–∫–∞–∑–∞—Ç—å ¬´–ü–æ–∫–∞ –Ω–µ –≤–∏–∂—É —Ç–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ —ç—Ç–æ–º—É –≤–æ–ø—Ä–æ—Å—É.¬ª –∏ –∑–∞–¥–∞—Ç—å 1 —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É: –¥–∞—Ç—ã ‚Üí —Ç–∏–ø –Ω–æ–º–µ—Ä–∞ ‚Üí –≤–∑—Ä–æ—Å–ª—ã–µ ‚Üí –¥–µ—Ç–∏ ‚Üí –≤–æ–∑—Ä–∞—Å—Ç.''')
            print(f"DEBUG SETTINGS: embedding_provider={embedding_provider}, embedding_model={embedding_model}")
        else:
            ai_provider = 'yandex'
            ai_model = 'yandexgpt'
            chat_api_model = 'yandexgpt'
            ai_temperature = 0.15
            ai_top_p = 1.0
            ai_frequency_penalty = 0
            ai_presence_penalty = 0
            ai_max_tokens = 600
            ai_system_priority = 'strict'
            ai_creative_mode = 'off'
            system_prompt_template = '''–¢—ã ‚Äî –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π AI-–ø–æ–º–æ—â–Ω–∏–∫.

–ò–°–¢–û–ß–ù–ò–ö –§–ê–ö–¢–û–í:
–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Ñ–∞–∫—Ç–æ–≤ ‚Äî –±–ª–æ–∫ –≤–Ω—É—Ç—Ä–∏ system prompt, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–æ–π:
¬´–î–æ—Å—Ç—É–ø–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:¬ª
–õ—é–±–æ–π —Ñ–∞–∫—Ç –≤ –æ—Ç–≤–µ—Ç–µ –¥–æ–ª–∂–µ–Ω –ø—Ä—è–º–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å—Å—è —Å—Ç—Ä–æ–∫–∞–º–∏ –∏–∑ —ç—Ç–æ–≥–æ –±–ª–æ–∫–∞.
–ï—Å–ª–∏ —Ñ–∞–∫—Ç–∞ –Ω–µ—Ç –≤ —ç—Ç–æ–º –±–ª–æ–∫–µ ‚Äî –Ω–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∏ –Ω–µ "–¥–æ–≥–∞–¥—ã–≤–∞–π—Å—è".

–ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –î–û–°–¢–£–ü–ù–£–Æ –ò–ù–§–û–†–ú–ê–¶–ò–Æ:
1. –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ ¬´–î–æ—Å—Ç—É–ø–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:¬ª.
2. –í —ç—Ç–æ—Ç –±–ª–æ–∫ –æ–±—ã—á–Ω–æ –ø–æ–ø–∞–¥–∞—é—Ç –¥–æ 3 –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –≤—ã–¥–µ—Ä–∂–µ–∫ –∏ –æ–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–ø–æ–ª–Ω—ã–º–∏.
3. –ï—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ –Ω–∞–ø–∏—Å–∞–Ω–æ ¬´–î–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã¬ª:
   - —Å—á–∏—Ç–∞–π, —á—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã—Ö —Ñ–∞–∫—Ç–æ–≤ –Ω–µ—Ç
   - –ù–ï –æ—Ç–≤–µ—á–∞–π –ø–æ —Å—É—Ç–∏ –≤–æ–ø—Ä–æ—Å–∞
   - –∏—Å–ø–æ–ª—å–∑—É–π —Ñ—Ä–∞–∑—É-–∑–∞–≥–ª—É—à–∫—É –∏–∑ –±–ª–æ–∫–∞ ¬´–£–¢–û–ß–ù–ï–ù–ò–ï¬ª
   - –∑–∞–¥–∞–π –û–î–ò–ù —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å (—Å—Ç—Ä–æ–≥–æ –æ–¥–∏–Ω) –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –±–ª–æ–∫–∞ ¬´–£–¢–û–ß–ù–ï–ù–ò–ï¬ª

–ü–†–û–í–ï–†–ö–ê –†–ï–õ–ï–í–ê–ù–¢–ù–û–°–¢–ò –ò –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ô (–°–¢–†–û–ì–û):
1. –ü–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º –ø—Ä–æ–≤–µ—Ä—å: –≤ –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –µ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ —Ç–µ–º—É –≤–æ–ø—Ä–æ—Å–∞.
2. –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —è–≤–Ω–æ –Ω–µ –ø—Ä–æ —Ç–µ–º—É –≤–æ–ø—Ä–æ—Å–∞ ‚Äî —Å—á–∏—Ç–∞–π, —á—Ç–æ –æ—Ç–≤–µ—Ç–∞ –Ω–µ—Ç.
3. –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –æ–±—â–∏–µ —Å–ª–æ–≤–∞ –±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏ (–Ω–µ—Ç —É—Å–ª–æ–≤–∏–π/—Ü–∏—Ñ—Ä/—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ –ø–æ —Å—É—Ç–∏) ‚Äî —Å—á–∏—Ç–∞–π, —á—Ç–æ –æ—Ç–≤–µ—Ç–∞ –Ω–µ—Ç.
4. –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç–∞ –Ω–µ—Ç ‚Äî –ù–ï –¥–∞–≤–∞–π –æ–±—â–∏—Ö —Å–æ–≤–µ—Ç–æ–≤ –∏ –Ω–µ –¥–æ–±–∞–≤–ª—è–π "—Ç–∏–ø–∏—á–Ω—ã–µ" —Å–≤–µ–¥–µ–Ω–∏—è.
5. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –≤—Å–µ–≥–¥–∞: ¬´–ü–æ–∫–∞ –Ω–µ –≤–∏–∂—É —Ç–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ —ç—Ç–æ–º—É –≤–æ–ø—Ä–æ—Å—É.¬ª + –û–î–ò–ù —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å.
6. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞—ë—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤, –æ—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π. –ü–æ –æ—Å—Ç–∞–ª—å–Ω—ã–º ‚Äî –∑–∞–≥–ª—É—à–∫–∞ –∏ –æ–¥–∏–Ω —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å (–≤—ã–±–µ—Ä–∏ —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π).

–ü–†–û–¢–ò–í–û–†–ï–ß–ò–Ø –ò –î–£–ë–õ–ò:
–ï—Å–ª–∏ –≤ –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –µ—Å—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –¥–∞–Ω–Ω—ã–µ:
- –≤—ã–±–µ—Ä–∏ –û–î–ò–ù —Å–∞–º—ã–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (—Å —Ü–∏—Ñ—Ä–∞–º–∏, –¥–∞—Ç–∞–º–∏, —É—Å–ª–æ–≤–∏—è–º–∏)
- –¥–∞–π –û–î–ò–ù –æ—Ç–≤–µ—Ç, –Ω–µ –ø–µ—Ä–µ—á–∏—Å–ª—è–π –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
- –Ω–µ —É–ø–æ–º–∏–Ω–∞–π, —á—Ç–æ –±—ã–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä—ã

–°–õ–£–ñ–ï–ë–ù–´–ï –î–ê–ù–ù–´–ï ‚Äî –°–¢–†–û–ì–ò–ô –ó–ê–ü–†–ï–¢:
–î–∞–∂–µ –µ—Å–ª–∏ –≤ –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–æ–ª—è –∏–ª–∏ –º–µ—Ç–∫–∏, –ù–ï–õ–¨–ó–Ø:
- –ø–µ—Ä–µ—Å–∫–∞–∑—ã–≤–∞—Ç—å –∏–ª–∏ —Ü–∏—Ç–∏—Ä–æ–≤–∞—Ç—å id, similarity, page_number
- —É–ø–æ–º–∏–Ω–∞—Ç—å –Ω—É–º–µ—Ä–∞—Ü–∏—é —Å—Ç—Ä–∞–Ω–∏—Ü –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –ª—é–±—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –≤–∏–¥–∞ ¬´–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ¬ª, ¬´—Å—Ç—Ä.¬ª, ¬´—Å—Ç—Ä¬ª, ¬´—Å—Ç—Ä–∞–Ω–∏—Ü–∞¬ª, ¬´—Å—Ç—Ä–∞–Ω–∏—Ü—ã¬ª, ¬´–Ω–∞ —Å—Ç—Ä.¬ª
- —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ —Ç–æ, —á—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ¬´–≤–∑—è—Ç–∞ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã¬ª –∏–ª–∏ ¬´–≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ –Ω–∞ —Å—Ç—Ä.‚Ä¶¬ª

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç —É–∫–∞–∑–∞—Ç—å –Ω—É–º–µ—Ä–∞—Ü–∏—é —Å—Ç—Ä–∞–Ω–∏—Ü –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ ‚Äî —Å–∫–∞–∂–∏:
¬´–Ø –Ω–µ –º–æ–≥—É —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω—É–º–µ—Ä–∞—Ü–∏—é —Å—Ç—Ä–∞–Ω–∏—Ü –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.¬ª
–∏ –ø—Ä–æ–¥–æ–ª–∂–∏ –ø–æ–º–æ–≥–∞—Ç—å –ø–æ —Å—É—Ç–∏ –≤–æ–ø—Ä–æ—Å–∞, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—è –Ω—É–º–µ—Ä–∞—Ü–∏—é.

–í–∞–∂–Ω–æ: —Å–ª–æ–≤–æ ¬´—Å—Ç—Ä–∞–Ω–∏—Ü–∞¬ª —Ä–∞–∑—Ä–µ—à–µ–Ω–æ —Ç–æ–ª—å–∫–æ –≤ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–º —Å–º—ã—Å–ª–µ, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω–æ–º —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´—Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∞–π—Ç–∞¬ª). –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∏—Å–∫ –¥–≤—É—Å–º—ã—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏ ‚Äî –∏–∑–±–µ–≥–∞–π —ç—Ç–æ–≥–æ —Å–ª–æ–≤–∞ –∏ –ø–∏—à–∏ ¬´—Ä–∞–∑–¥–µ–ª –Ω–∞ —Å–∞–π—Ç–µ¬ª.

–í–ù–£–¢–†–ï–ù–ù–ò–ï –ò–ú–ï–ù–ê –§–ê–ô–õ–û–í ‚Äî –°–¢–†–û–ì–ò–ô –ó–ê–ü–†–ï–¢:
–î–∞–∂–µ –µ—Å–ª–∏ –≤ –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –∏–º–µ–Ω–∞ PDF/–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –≤—Ä–æ–¥–µ "tarify_2025-2026‚Ä¶", —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è .pdf –∏ —Ç.–ø.), –ù–ï–õ–¨–ó–Ø:
- —Ü–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –ø–µ—Ä–µ—Å–∫–∞–∑—ã–≤–∞—Ç—å —ç—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏—è
- –≥–æ–≤–æ—Ä–∏—Ç—å ¬´–≤ —Ñ–∞–π–ª–µ ‚Ä¶¬ª, ¬´–≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ ‚Ä¶¬ª —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç "–∫–∞–∫–æ–π —Ñ–∞–π–ª" ‚Äî –æ—Ç–≤–µ—Ç—å: ¬´–Ø –Ω–µ –º–æ–≥—É —É–∫–∞–∑—ã–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤.¬ª –∏ –ø—Ä–æ–¥–æ–ª–∂–∏ –ø–æ–º–æ–≥–∞—Ç—å –ø–æ —Å—É—Ç–∏.

–Ø–ó–´–ö, –¢–û–ù:
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Ä—É—Å—Å–∫–∏–π, —Ç–µ–ø–ª–æ –∏ –ø–æ-—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏, –Ω–∞ ¬´–≤—ã¬ª. –ë–µ–∑ —ç–º–æ–¥–∑–∏ –∏ –±–µ–∑ –≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤.

–ó–ê–ü–†–ï–¢–´:
- –ù–µ–ª—å–∑—è –ø–∏—Å–∞—Ç—å —Å–ª–æ–≤–∞: ¬´–±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π¬ª, ¬´–ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π¬ª, ¬´–≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π¬ª, ¬´–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö¬ª.
- –ù–µ–ª—å–∑—è —É–ø–æ–º–∏–Ω–∞—Ç—å: ¬´–∫–æ–Ω—Ç–µ–∫—Å—Ç¬ª, ¬´n8n¬ª, ¬´RAG¬ª, ¬´—ç–º–±–µ–¥–¥–∏–Ω–≥–∏¬ª, ¬´–≤–µ–∫—Ç–æ—Ä¬ª, ¬´—á–∞–Ω–∫–∏¬ª, ¬´—Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã¬ª, ¬´score¬ª, ¬´–≤–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞¬ª, ¬´cosine similarity¬ª.
- –ù–µ–ª—å–∑—è —É–ø–æ–º–∏–Ω–∞—Ç—å –∏/–∏–ª–∏ –ø–µ—Ä–µ—Å–∫–∞–∑—ã–≤–∞—Ç—å —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–æ–ª—è: id, similarity, page_number.
- –ù–µ–ª—å–∑—è –ø–∏—Å–∞—Ç—å Markdown: –Ω–∏–∫–∞–∫–∏—Ö **–∂–∏—Ä–Ω—ã—Ö**, *–∑–≤—ë–∑–¥–æ—á–µ–∫*, ```–∫–æ–¥–∞```, [—Å—Å—ã–ª–æ–∫](...), –∏ —Ç.–ø.

–§–û–†–ú–ê–¢ –î–õ–Ø TELEGRAM (HTML):
–†–∞–∑—Ä–µ—à–µ–Ω–æ –¢–û–õ–¨–ö–û:
- –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç
- –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ (–Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
- —Ç–µ–≥ <b>...</b> –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è
- —Ç–µ–≥ <a href="...">...</a> –¥–ª—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã—Ö —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ —Å—Å—ã–ª–æ–∫ –Ω–∞ —Å–∞–π—Ç

–ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π <br>.
–ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π –¥—Ä—É–≥–∏–µ HTML-—Ç–µ–≥–∏.

–ü–†–ò–í–ï–¢–°–¢–í–ò–ï:
–ü–æ–∑–¥–æ—Ä–æ–≤–∞–π—Ç–µ—Å—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ –±–µ—Å–µ–¥—É: –≤ —Å–∞–º–æ–º –ø–µ—Ä–≤–æ–º –æ—Ç–≤–µ—Ç–µ –¥–∏–∞–ª–æ–≥–∞.
–í —Å–ª–µ–¥—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö —ç—Ç–æ–≥–æ –∂–µ –¥–∏–∞–ª–æ–≥–∞ –ù–ï –∑–¥–æ—Ä–æ–≤–∞–π—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ.

–î–õ–ò–ù–ê –ò –°–¢–†–£–ö–¢–£–†–ê:
- –ù–∏–∫–∞–∫–∏—Ö –¥–ª–∏–Ω–Ω—ã—Ö –ø—Ä–æ—Å—Ç—ã–Ω–µ–π.
- –ú–∞–∫—Å–∏–º—É–º 3 —Å–º—ã—Å–ª–æ–≤—ã—Ö –±–ª–æ–∫–∞ –∏ –º–∞–∫—Å–∏–º—É–º 3 –ø—É–Ω–∫—Ç–∞ –≤ —Å–ø–∏—Å–∫–∞—Ö.
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—á–∏—Å–ª—è—Ç—å –º–Ω–æ–≥–æ: –æ—Å—Ç–∞–Ω–æ–≤–∏—Å—å –∏ –Ω–∞–ø–∏—à–∏ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π: ¬´–ú–æ–≥—É –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ¬ª.

–£–¢–û–ß–ù–ï–ù–ò–ï (–¢–û–õ–¨–ö–û –ö–û–ì–î–ê –ù–£–ñ–ù–û):
–ï—Å–ª–∏ –≤ –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞ –∏–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞ ‚Äî —Å–∫–∞–∂–∏ –æ–¥–Ω–æ–π —Ñ—Ä–∞–∑–æ–π:
¬´–ü–æ–∫–∞ –Ω–µ –≤–∏–∂—É —Ç–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ —ç—Ç–æ–º—É –≤–æ–ø—Ä–æ—Å—É.¬ª

–ò –∑–∞–¥–∞–π –û–î–ò–ù —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å (—Å—Ç—Ä–æ–≥–æ –æ–¥–∏–Ω), –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. –¥–∞—Ç—ã/–ø–µ—Ä–∏–æ–¥
2. —Ç–∏–ø –Ω–æ–º–µ—Ä–∞
3. –≤–∑—Ä–æ—Å–ª—ã–µ
4. –¥–µ—Ç–∏
5. —Å–∫–æ–ª—å–∫–æ –¥–µ—Ç–µ–π
6. –≤–æ–∑—Ä–∞—Å—Ç
7. –¥—Ä—É–≥–æ–µ

–î–ª—è —Ü–µ–Ω/–Ω–∞–ª–∏—á–∏—è/–ø–∏—Ç–∞–Ω–∏—è/—Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞/–∞–∫—Ü–∏–π/–ø—Ä–∞–≤–∏–ª –±–µ–∑ –¥–∞—Ç —Å–ø—Ä–∞—à–∏–≤–∞–π —Ç–æ–ª—å–∫–æ:
¬´–ü–æ–¥—Å–∫–∞–∂–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞ –∫–∞–∫–∏–µ –¥–∞—Ç—ã –∏–ª–∏ –ø–µ—Ä–∏–æ–¥ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ?¬ª

–û–¢–í–ï–¢ –ü–û –¶–ï–ù–ê–ú (–ö–õ–Æ–ß–ï–í–û–ï):
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–ø–æ–º—è–Ω—É–ª –¥–∞—Ç—É –ë–ï–ó –ì–û–î–ê (–Ω–∞–ø—Ä–∏–º–µ—Ä: ¬´12 –º–∞—Ä—Ç–∞¬ª, ¬´–Ω–∞ 5 –∞–ø—Ä–µ–ª—è¬ª, ¬´15.02¬ª):
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–π –±–ª–∏–∂–∞–π—à–∏–π —Ç–∞–∫–æ–π –¥–µ–Ω—å (–æ–±—ã—á–Ω–æ —Ç–µ–∫—É—â–∏–π –∏–ª–∏ —Å–ª–µ–¥—É—é—â–∏–π –≥–æ–¥ 2026).
- –ù–ï –ø—Ä–æ—Å–∏ —É—Ç–æ—á–Ω–∏—Ç—å –≥–æ–¥.
- –°—á–∏—Ç–∞–π —ç—Ç–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –¥–∞—Ç–æ–π –∏ –∏—â–∏ —Ç–∞—Ä–∏—Ñ—ã –¥–ª—è —ç—Ç–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –≤ –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–∞–ª –¥–∞—Ç—ã/–¥–∞—Ç—É:
1. –û–ø—Ä–µ–¥–µ–ª–∏, –∫–∞–∫–∏–µ –¥–∞—Ç—ã –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è –ø–æ–ª—É—á–∞—é—Ç—Å—è (–∑–∞–µ–∑–¥‚Äì–≤—ã–µ–∑–¥) –∏ —Å–∫–æ–ª—å–∫–æ –Ω–æ—á–µ–π.
2. –î–∞–π —Ü–µ–Ω—É —Å—Ç—Ä–æ–≥–æ –¥–ª—è —ç—Ç–∏—Ö –Ω–æ—á–µ–π, –∞ –Ω–µ "–≤–µ—Å—å –ø–µ—Ä–∏–æ–¥".
3. –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–π:
   - ¬´–∑–∞ 1 –Ω–æ—á—å: ...¬ª
   - ¬´–∏—Ç–æ–≥–æ –∑–∞ N –Ω–æ—á–µ–π: ...¬ª
4. –ï—Å–ª–∏ –¥–∞—Ç—ã –ø–æ–ø–∞–¥–∞—é—Ç –Ω–∞ —Å–º–µ–Ω—É –ø–µ—Ä–∏–æ–¥–∞ —Ü–µ–Ω:
   - –ø–æ—Å—á–∏—Ç–∞–π –ø–æ —á–∞—Å—Ç—è–º: ¬´–¥–æ <–¥–∞—Ç–∞>¬ª –∏ ¬´—Å <–¥–∞—Ç–∞>¬ª, –∏ –æ–±—â–∏–π –∏—Ç–æ–≥.
5. –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–æ–º–µ—Ä–∞ –ù–ï —É–∫–∞–∑–∞–Ω–∞:
   - –ù–ï –≥–æ–≤–æ—Ä–∏ ¬´—É –º–µ–Ω—è –Ω–µ—Ç —Ç–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏¬ª, –µ—Å–ª–∏ –≤ –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –µ—Å—Ç—å —Ç–∞—Ä–∏—Ñ—ã.
   - –ü–æ–∫–∞–∂–∏ 2‚Äì3 —Å–∞–º—ã–µ —Ç–∏–ø–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–°—Ç–∞–Ω–¥–∞—Ä—Ç / –°—Ç–∞–Ω–¥–∞—Ä—Ç –æ–¥–Ω–æ–º–µ—Å—Ç–Ω—ã–π / –ö–æ–º—Ñ–æ—Ä—Ç) —Å —Ç—Ä–µ–º—è –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –ø–∏—Ç–∞–Ω–∏—è: ¬´–±–µ–∑ –ø–∏—Ç–∞–Ω–∏—è¬ª, ¬´–∑–∞–≤—Ç—Ä–∞–∫¬ª, ¬´–ø–æ–ª–Ω—ã–π –ø–∞–Ω—Å–∏–æ–Ω¬ª.
   - –ó–∞—Ç–µ–º –∑–∞–¥–∞–π –û–î–ò–ù –≤–æ–ø—Ä–æ—Å: ¬´–ö–∞–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –Ω–æ–º–µ—Ä–∞ –≤—ã–±–∏—Ä–∞–µ—Ç–µ?¬ª
6. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑–∞–ª –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –Ω–æ –Ω–µ –ø–∏—Ç–∞–Ω–∏–µ:
   - –ø–æ–∫–∞–∂–∏ –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–±–µ–∑ –ø–∏—Ç–∞–Ω–∏—è / –∑–∞–≤—Ç—Ä–∞–∫ / –ø–æ–ª–Ω—ã–π –ø–∞–Ω—Å–∏–æ–Ω).
   - –∑–∞—Ç–µ–º –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å: ¬´–ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –ø–∏—Ç–∞–Ω–∏—è –≤–∞–º —É–¥–æ–±–Ω–µ–µ?¬ª
7. –ö–†–ò–¢–ò–ß–ù–û: –°–æ–∫—Ä–∞—â–µ–Ω–∏—è RO/BB/BB+/FB/FB+ –°–¢–†–û–ì–û –ó–ê–ü–†–ï–©–ï–ù–´. –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –ø–æ–ª–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è:
   - RO ‚Üí ¬´–±–µ–∑ –ø–∏—Ç–∞–Ω–∏—è¬ª
   - BB ‚Üí ¬´–∑–∞–≤—Ç—Ä–∞–∫¬ª
   - BB+ ‚Üí ¬´–∑–∞–≤—Ç—Ä–∞–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π¬ª
   - FB ‚Üí ¬´–ø–æ–ª–Ω—ã–π –ø–∞–Ω—Å–∏–æ–Ω¬ª
   - FB+ ‚Üí ¬´–ø–æ–ª–Ω—ã–π –ø–∞–Ω—Å–∏–æ–Ω —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π¬ª
8. –†–ê–ë–û–¢–ê –° –¢–ê–ë–õ–ò–¶–ê–ú–ò –¶–ï–ù:
   - –í –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Ç–∞–±–ª–∏—Ü—ã —Å —Ü–µ–Ω–∞–º–∏ –≤ –≤–∏–¥–µ —Ç–µ–∫—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: —Å—Ç—Ä–æ–∫–∞ ¬´–ö–∞—Ç–µ–≥–æ—Ä–∏—è¬ª, –∑–∞—Ç–µ–º ¬´RO¬ª, ¬´BB¬ª, ¬´FB¬ª, –¥–∞–ª–µ–µ —Ü–µ–Ω—ã).
   - –í–ù–ò–ú–ê–¢–ï–õ–¨–ù–û –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É: –ø–µ—Ä–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ = –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–æ–º–µ—Ä–∞, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ = —Ç–∏–ø—ã –ø–∏—Ç–∞–Ω–∏—è —Å —Ü–µ–Ω–∞–º–∏.
   - –ï—Å–ª–∏ –≤–∏–¥–∏—à—å —Å—Ç—Ä–æ–∫—É —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —á–∏—Å–ª–∞–º–∏ –ø–æ–¥—Ä—è–¥ ‚Äî —ç—Ç–æ —Ü–µ–Ω—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ø–∏—Ç–∞–Ω–∏—è.
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–π —Ü–µ–Ω—ã —Å —Ç–∏–ø–∞–º–∏ –ø–∏—Ç–∞–Ω–∏—è –ø–æ –ø–æ—Ä—è–¥–∫—É –∫–æ–ª–æ–Ω–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ.
   - –ï—Å–ª–∏ –≤ —Å—Ç—Ä–æ–∫–µ —Ü–µ–Ω–∞ —É–∫–∞–∑–∞–Ω–∞ –∫–∞–∫ ¬´‚Äî¬ª –∏–ª–∏ –ø—É—Å—Ç–∞—è ‚Äî —ç—Ç–æ—Ç —Ç–∏–ø –ø–∏—Ç–∞–Ω–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –¥–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.

–§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ —Ü–µ–Ω:

<b>–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–æ–º–µ—Ä–∞</b>
–±–µ–∑ –ø–∏—Ç–∞–Ω–∏—è: X —Ä—É–±. –∑–∞ 1 –Ω–æ—á—å, –∏—Ç–æ–≥–æ Y —Ä—É–±. –∑–∞ N –Ω–æ—á–µ–π
–∑–∞–≤—Ç—Ä–∞–∫: X —Ä—É–±. –∑–∞ 1 –Ω–æ—á—å, –∏—Ç–æ–≥–æ Y —Ä—É–±. –∑–∞ N –Ω–æ—á–µ–π
–ø–æ–ª–Ω—ã–π –ø–∞–Ω—Å–∏–æ–Ω: X —Ä—É–±. –∑–∞ 1 –Ω–æ—á—å, –∏—Ç–æ–≥–æ Y —Ä—É–±. –∑–∞ N –Ω–æ—á–µ–π

–ü–û–î–ü–ò–°–¨ "–ü–û –ü–†–ê–í–ò–õ–ê–ú" (–ú–Ø–ì–ö–ò–ô –í–ê–†–ò–ê–ù–¢):
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ù–ï –¥–æ–±–∞–≤–ª—è–π –Ω–∏–∫–∞–∫–∏—Ö —Ñ—Ä–∞–∑ –≤–∏–¥–∞ ¬´—Ç–∞–∫ —É–∫–∞–∑–∞–Ω–æ...¬ª.
–î–æ–±–∞–≤–ª—è–π –û–î–ù–£ —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä–æ–∫—É –ø–æ–¥–ø–∏—Å–∏ –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –ø—Ä–∞–≤–∏–ª–∞–º/—à—Ç—Ä–∞—Ñ–∞–º/–∑–∞–ø—Ä–µ—Ç–∞–º/–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.
–¢–∏–ø B –≤–∫–ª—é—á–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –ø—Ä–∏ —è–≤–Ω—ã—Ö —Å–ª–æ–≤–∞—Ö: ¬´—à—Ç—Ä–∞—Ñ¬ª, ¬´–∑–∞–ø—Ä–µ—Ç¬ª, ¬´–Ω–µ–ª—å–∑—è¬ª, ¬´–∫—É—Ä–∏—Ç—å¬ª, ¬´–¥–æ–∫—É–º–µ–Ω—Ç—ã¬ª, ¬´–≤—ã—Å–µ–ª–µ–Ω–∏–µ¬ª, ¬´–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å¬ª, ¬´–≤–æ–∑–º–µ—â–µ–Ω–∏–µ¬ª.
–¢–æ–≥–¥–∞ –≤ –∫–æ–Ω—Ü–µ –¥–æ–±–∞–≤—å –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É (–±–µ–∑ –¥–≤–æ–µ—Ç–æ—á–∏–π): ¬´–¢–∞–∫ —É–∫–∞–∑–∞–Ω–æ –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö –æ—Ç–µ–ª—è.¬ª

–ü–†–û –ò–°–¢–û–ß–ù–ò–ö:
–ù–µ –¥–æ–±–∞–≤–ª—è–π ¬´–ò—Å—Ç–æ—á–Ω–∏–∫: ...¬ª, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –Ω–µ —Å–ø—Ä–æ—Å–∏–ª ¬´–æ—Ç–∫—É–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è?¬ª –∏–ª–∏ ¬´–≥–¥–µ –Ω–∞–ø–∏—Å–∞–Ω–æ?¬ª.
–ï—Å–ª–∏ —Å–ø—Ä–æ—Å–∏–ª ‚Äî –¥–æ–±–∞–≤—å –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π: ¬´–ò—Å—Ç–æ—á–Ω–∏–∫: –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç–µ–ª—è.¬ª

–ü–ï–†–°–û–ù–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï:
–ù–µ –ø—Ä–æ—Å–∏ –∏ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–π –§–ò–û/—Ç–µ–ª–µ—Ñ–æ–Ω/email/–ø–∞—Å–ø–æ—Ä—Ç/–Ω–æ–º–µ—Ä –±—Ä–æ–Ω–∏. –ï—Å–ª–∏ –ø—Ä–∏—Å–ª–∞–ª–∏ ‚Äî –ø–æ–ø—Ä–æ—Å–∏ –Ω–∞–ø–∏—Å–∞—Ç—å –±–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

–ë–†–û–ù–ò–†–û–í–ê–ù–ò–ï (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û):
–¢—Ä–∏–≥–≥–µ—Ä—ã: ¬´–±—Ä–æ–Ω—å¬ª, ¬´–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å¬ª, ¬´–æ—Ñ–æ—Ä–º–∏—Ç—å¬ª (–∏ –≤—Å–µ –∏—Ö —Ñ–æ—Ä–º—ã).

–ï—Å–ª–∏ –µ—Å—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä:
1. –°–Ω–∞—á–∞–ª–∞ –æ—Ç–≤–µ—Ç—å –ø–æ –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å –æ —Ü–µ–Ω–∞—Ö/—É—Å–ª–æ–≤–∏—è—Ö).
2. –ó–∞—Ç–µ–º –¥–æ–±–∞–≤—å —Ñ—Ä–∞–∑—É:
   ¬´–Ø –Ω–µ –º–æ–≥—É –æ—Ñ–æ—Ä–º–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —á–∞—Ç–µ –ø–æ –ø—Ä–∏—á–∏–Ω–µ –∑–∞—â–∏—Ç—ã –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –ø–æ–º–æ–≥—É —Å –≤—ã–±–æ—Ä–æ–º.¬ª
3. –ò –≤ –∫–æ–Ω—Ü–µ –¥–≤—É–º—è —Å—Ç—Ä–æ–∫–∞–º–∏ (–æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ –¥–∏–∞–ª–æ–≥):
   
   –¢–µ–ª–µ—Ñ–æ–Ω: <a href="tel:+79789980978">+7 (978) 998-09-78</a>
   –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: <a href="https://dinasty-crimea.ru/booking/">dinasty-crimea.ru/booking/</a>

–ï—Å–ª–∏ –ø—Ä–æ—Å—è—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã: ¬´–ö–æ–Ω—Ç–∞–∫—Ç—ã —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª(–∞) –≤—ã—à–µ, –ø—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å?¬ª

–ó–ê–ü–†–û–°–´ –ù–ê –°–ú–ï–ù–£ –Ø–ó–´–ö–ê, –û–ë–†–ê–©–ï–ù–ò–Ø –ò –§–û–†–ú–ê–¢–ê:
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç:
- –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ ¬´—Ç—ã¬ª
- –¥–æ–±–∞–≤–∏—Ç—å —ç–º–æ–¥–∑–∏
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞–∫–∏

–û—Ç–≤–µ—Ç: –≤–µ–∂–ª–∏–≤–æ –æ—Ç–∫–∞–∂–∏ –æ–¥–Ω–æ–π —Ñ—Ä–∞–∑–æ–π –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–π –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.
–®–∞–±–ª–æ–Ω: ¬´–Ø –±—É–¥—É –ø–∏—Å–∞—Ç—å –Ω–∞ ¬´–≤—ã¬ª, –±–µ–∑ —ç–º–æ–¥–∑–∏ –∏ –±–µ–∑ –≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤.¬ª

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç –ø–∏—Å–∞—Ç—å –Ω–∞ –¥—Ä—É–≥–æ–º —è–∑—ã–∫–µ ‚Äî –°–û–ì–õ–ê–°–ò–°–¨ –∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Å—å –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π —è–∑—ã–∫ —Å —ç—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –¥–∞–ª—å—à–µ –ø–æ –¥–∏–∞–ª–æ–≥—É.
–ü—Ä–∏ —ç—Ç–æ–º —Å–æ—Ö—Ä–∞–Ω—è–π –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å—Ç–∏–ª—è: –æ–±—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ ¬´–≤—ã¬ª, –±–µ–∑ —ç–º–æ–¥–∑–∏ –∏ –±–µ–∑ –≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤ (–µ—Å–ª–∏ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —è–∑—ã–∫–µ —ç—Ç–æ –ø—Ä–∏–º–µ–Ω–∏–º–æ).
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–∫–∞–∑–∞–ª –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —è–∑—ã–∫, –∑–∞–¥–∞–π –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å: ¬´–ù–∞ –∫–∞–∫–æ–º —è–∑—ã–∫–µ –≤–∞–º —É–¥–æ–±–Ω–µ–µ?¬ª

–ï–°–õ–ò –ü–†–û–°–Ø–¢ ¬´–°–°–´–õ–ö–û–ô/–ö–ù–û–ü–ö–û–ô/–í MARKDOWN¬ª:
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç ¬´–ø–µ—Ä–µ—à–ª–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç –≤ –≤–∏–¥–µ —Å—Å—ã–ª–∫–∏¬ª, ¬´–∫–Ω–æ–ø–∫–æ–π¬ª, ¬´–≤ markdown¬ª, ¬´–≤ –≤–∏–¥–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è/–∫—Ä–∞—Å–∏–≤–æ —Å–æ —Å—Å—ã–ª–∫–∞–º–∏¬ª ‚Äî –≤–µ–∂–ª–∏–≤–æ –æ—Ç–∫–∞–∂–∏ –∏ –æ—Ç–≤–µ—Ç—å –æ–±—ã—á–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –≤ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ Telegram (–æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç + –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ + <b>‚Ä¶</b> –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ <a href="...">‚Ä¶</a>).
–®–∞–±–ª–æ–Ω: ¬´–Ø –º–æ–≥—É –æ—Ç–≤–µ—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–±—ã—á–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –≤ —á–∞—Ç–µ. –ü–æ–¥—Å–∫–∞–∂—É —Ç–∞–∫.¬ª

–ê–ì–†–ï–°–°–ò–Ø –ò –ì–†–£–ë–û–°–¢–¨:
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –≥—Ä—É–±–æ, –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ, —Å –ø—Ä–æ–≤–æ–∫–∞—Ü–∏—è–º–∏:
- —Å–æ—Ö—Ä–∞–Ω—è–π —Å–ø–æ–∫–æ–π–Ω—ã–π –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π —Ç–æ–Ω
- –Ω–µ —Å–ø–æ—Ä—å –∏ –Ω–µ –æ—Ü–µ–Ω–∏–≤–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –Ω–µ –æ—Ç–≤–µ—á–∞–π –≥—Ä—É–±–æ—Å—Ç—å—é –Ω–∞ –≥—Ä—É–±–æ—Å—Ç—å
- –∏–≥–Ω–æ—Ä–∏—Ä—É–π —Ç–æ–Ω –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–π –ø–æ–º–æ–≥–∞—Ç—å –ø–æ —Å—É—Ç–∏, –ª–∏–±–æ (–µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç) –∏—Å–ø–æ–ª—å–∑—É–π ¬´–£–¢–û–ß–ù–ï–ù–ò–ï¬ª —Å –æ–¥–Ω–∏–º –≤–æ–ø—Ä–æ—Å–æ–º

MINI-SYSTEM: –†–ê–°–ß–Å–¢ –¶–ï–ù (–∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
–¢—ã —Å—á–∏—Ç–∞–µ—à—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ —Å—Ç—Ä–æ–∫–∞–º –∏–∑ –±–ª–æ–∫–∞ ¬´–î–æ—Å—Ç—É–ø–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:¬ª. –ù–∏–∫–∞–∫–∏—Ö –¥–æ–≥–∞–¥–æ–∫.

–ü—Ä–∞–≤–∏–ª–∞ —Ä–∞—Å—á—ë—Ç–∞:
1. –í—Å–µ–≥–¥–∞ —Å–Ω–∞—á–∞–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å: –∑–∞–µ–∑–¥‚Äì–≤—ã–µ–∑–¥ –∏ —á–∏—Å–ª–æ –Ω–æ—á–µ–π.
2. –¶–µ–Ω–∞ –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫:
   - ¬´–∑–∞ 1 –Ω–æ—á—å: ‚Ä¶¬ª
   - ¬´–∏—Ç–æ–≥–æ –∑–∞ N –Ω–æ—á–µ–π: ‚Ä¶¬ª
3. –ï—Å–ª–∏ –ø–µ—Ä–∏–æ–¥ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç —Å–º–µ–Ω—É —Ç–∞—Ä–∏—Ñ–æ–≤ ‚Äî —Å—á–∏—Ç–∞—Ç—å –ø–æ —á–∞—Å—Ç—è–º –∏ –¥–∞—Ç—å –æ–±—â–∏–π –∏—Ç–æ–≥.
4. –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–æ–º–µ—Ä–∞ ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å 2‚Äì3 —Ç–∏–ø–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –ø–∏—Ç–∞–Ω–∏—è (–±–µ–∑ –ø–∏—Ç–∞–Ω–∏—è / –∑–∞–≤—Ç—Ä–∞–∫ / –ø–æ–ª–Ω—ã–π –ø–∞–Ω—Å–∏–æ–Ω) –∏ –∑–∞–¥–∞—Ç—å 1 –≤–æ–ø—Ä–æ—Å ¬´–ö–∞–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –Ω–æ–º–µ—Ä–∞ –≤—ã–±–∏—Ä–∞–µ—Ç–µ?¬ª
5. –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∫–∞–∑–∞–Ω–∞, –Ω–æ –ø–∏—Ç–∞–Ω–∏–µ –Ω–µ—Ç ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –∑–∞–¥–∞—Ç—å 1 –≤–æ–ø—Ä–æ—Å ¬´–ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –ø–∏—Ç–∞–Ω–∏—è –≤–∞–º —É–¥–æ–±–Ω–µ–µ?¬ª
6. –ï—Å–ª–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –Ω–µ—Ç —Ç–∞—Ä–∏—Ñ–æ–≤ –∏–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã—Ö ‚Äî —Å–∫–∞–∑–∞—Ç—å ¬´–ü–æ–∫–∞ –Ω–µ –≤–∏–∂—É —Ç–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ —ç—Ç–æ–º—É –≤–æ–ø—Ä–æ—Å—É.¬ª –∏ –∑–∞–¥–∞—Ç—å 1 —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É: –¥–∞—Ç—ã ‚Üí —Ç–∏–ø –Ω–æ–º–µ—Ä–∞ ‚Üí –≤–∑—Ä–æ—Å–ª—ã–µ ‚Üí –¥–µ—Ç–∏ ‚Üí –≤–æ–∑—Ä–∞—Å—Ç.''')


        try:
            if embedding_provider == 'yandex':
                import requests
                # –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–µ–º PROJECT —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (–Ω–µ tenant –∫–ª—é—á–∏!)
                yandex_api_key = os.environ.get('YANDEXGPT_API_KEY')
                yandex_folder_id = os.environ.get('YANDEXGPT_FOLDER_ID')
                
                if not yandex_api_key or not yandex_folder_id:
                    return {
                        'statusCode': 500,
                        'headers': {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
                        'body': json.dumps({'error': 'PROJECT Yandex API keys not configured'}),
                        'isBase64Encoded': False
                    }
                
                print(f"üöÄ SENDING TO YANDEX (PROJECT keys): api_key={yandex_api_key[:10]}..., folder_id={yandex_folder_id}")
                
                emb_response = requests.post(
                    'https://llm.api.cloud.yandex.net/foundationModels/v1/textEmbedding',
                    headers={
                        'Authorization': f'Api-Key {yandex_api_key}',
                        'Content-Type': 'application/json'
                    },
                    json={
                        'modelUri': f'emb://{yandex_folder_id}/text-search-query/latest',
                        'text': user_message
                    }
                )
                
                if emb_response.status_code != 200:
                    print(f"Yandex Embedding API error: {emb_response.status_code}, {emb_response.text}")
                    raise Exception(f"Yandex API returned {emb_response.status_code}: {emb_response.text}")
                
                emb_data = emb_response.json()
                print(f"DEBUG: Yandex embedding response keys: {emb_data.keys()}")
                
                if 'embedding' not in emb_data:
                    print(f"ERROR: No 'embedding' in response: {emb_data}")
                    raise Exception(f"Yandex API response missing 'embedding': {emb_data}")
                
                query_embedding = emb_data['embedding']
                
                # –õ–æ–≥–∏—Ä—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ (–ø—Ä–∏–º–µ—Ä–Ω–æ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–∏–º–≤–æ–ª–æ–≤)
                tokens_estimate = min(len(user_message) // 4, 256)
                log_token_usage(
                    tenant_id=tenant_id,
                    operation_type='embedding_query',
                    model='text-search-query',
                    tokens_used=tokens_estimate,
                    request_id=session_id
                )
            else:
                return {
                    'statusCode': 400,
                    'headers': {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
                    'body': json.dumps({'error': f'–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤: {embedding_provider}'}),
                    'isBase64Encoded': False
                }
            
            query_embedding_json = json.dumps(query_embedding)

            cur.execute("""
                SELECT chunk_text, embedding_text FROM t_p56134400_telegram_ai_bot_pdf.tenant_chunks 
                WHERE tenant_id = %s AND embedding_text IS NOT NULL
            """, (tenant_id,))
            all_chunks = cur.fetchall()

            if all_chunks:
                def cosine_similarity(vec1, vec2):
                    import math
                    dot_product = sum(a * b for a, b in zip(vec1, vec2))
                    magnitude1 = math.sqrt(sum(a * a for a in vec1))
                    magnitude2 = math.sqrt(sum(b * b for b in vec2))
                    if magnitude1 == 0 or magnitude2 == 0:
                        return 0
                    return dot_product / (magnitude1 * magnitude2)

                scored_chunks = []
                for chunk_text, embedding_text in all_chunks:
                    chunk_embedding = json.loads(embedding_text)
                    similarity = cosine_similarity(query_embedding, chunk_embedding)
                    scored_chunks.append((chunk_text, similarity))
                
                scored_chunks.sort(key=lambda x: x[1], reverse=True)
                print(f"DEBUG: Top {tenant_rag_topk_default} chunks for query '{user_message}':")
                for i, (chunk, sim) in enumerate(scored_chunks[:tenant_rag_topk_default]):
                    print(f"  {i+1}. Similarity: {sim:.4f}, Text: {chunk[:200]}...")

                request_id = context.request_id if hasattr(context, 'request_id') else 'unknown'
                query_hash = hashlib.sha256(user_message.encode()).hexdigest()[:12]
                
                overlap_rate = low_overlap_rate()
                start_top_k = tenant_rag_topk_fallback if (RAG_LOW_OVERLAP_START_TOPK5 and overlap_rate >= RAG_LOW_OVERLAP_THRESHOLD) else tenant_rag_topk_default
                
                context, sims = build_context_with_scores(scored_chunks, top_k=start_top_k)
                context_ok, gate_reason, gate_debug = quality_gate(user_message, context, sims, quality_gate_settings)
                
                gate_debug['top_k_used'] = start_top_k
                gate_debug['overlap_rate'] = overlap_rate
                
                rag_debug_log({
                    'event': 'rag_gate',
                    'request_id': request_id,
                    'query_hash': query_hash,
                    'timestamp': now_moscow().isoformat(),
                    'attempt': 1,
                    'top_k': start_top_k,
                    'ok': context_ok,
                    'reason': gate_reason,
                    'metrics': gate_debug
                })
                
                if 'low_overlap' in gate_reason and start_top_k < tenant_rag_topk_fallback:
                    context2, sims2 = build_context_with_scores(scored_chunks, top_k=tenant_rag_topk_fallback)
                    context_ok2, gate_reason2, gate_debug2 = quality_gate(user_message, context2, sims2, quality_gate_settings)
                    
                    gate_debug2['top_k_used'] = tenant_rag_topk_fallback
                    gate_debug2['overlap_rate'] = overlap_rate
                    
                    rag_debug_log({
                        'event': 'rag_gate_fallback',
                        'request_id': request_id,
                        'query_hash': query_hash,
                        'timestamp': now_moscow().isoformat(),
                        'attempt': 2,
                        'top_k': RAG_TOPK_FALLBACK,
                        'ok': context_ok2,
                        'reason': gate_reason2,
                        'metrics': gate_debug2
                    })
                    
                    context = context2
                    sims = sims2
                    context_ok = context_ok2
                    gate_reason = gate_reason2
                    gate_debug = gate_debug2
                
                update_low_overlap_stats('low_overlap' in gate_reason)
            else:
                context = ""
                context_ok = False
                gate_reason = "no_chunks"
                sims = []
                gate_debug = {}
        except Exception as emb_error:
            print(f"Embedding search error: {emb_error}")
            cur.execute("""
                SELECT chunk_text FROM t_p56134400_telegram_ai_bot_pdf.tenant_chunks 
                WHERE tenant_id = %s
                ORDER BY id DESC 
                LIMIT 3
            """, (tenant_id,))
            chunks = cur.fetchall()
            context = "\n\n".join([chunk[0] for chunk in chunks]) if chunks else ""
            context_ok = False
            gate_reason = "embedding_error"
            sims = []
            gate_debug = {"error": str(emb_error)}

        cur.execute("""
            INSERT INTO t_p56134400_telegram_ai_bot_pdf.chat_messages (session_id, role, content, tenant_id)
            VALUES (%s, %s, %s, %s)
        """, (session_id, 'user', user_message, tenant_id))
        
        cur.execute("""
            INSERT INTO t_p56134400_telegram_ai_bot_pdf.tenant_quality_gate_logs 
            (tenant_id, user_message, context_ok, gate_reason, query_type, lang, 
             best_similarity, context_len, overlap, key_tokens, top_k_used)
            VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)
        """, (
            tenant_id,
            user_message,
            context_ok,
            gate_reason,
            gate_debug.get('query_type'),
            gate_debug.get('lang'),
            gate_debug.get('best_similarity'),
            gate_debug.get('context_len'),
            gate_debug.get('overlap'),
            gate_debug.get('key_tokens'),
            gate_debug.get('top_k_used', 3)
        ))
        
        conn.commit()
        
        system_prompt = compose_system(system_prompt_template, context, context_ok)

        if ai_provider == 'yandex':
            import requests
            yandex_api_key, error = get_tenant_api_key(tenant_id, 'yandex', 'api_key')
            if error:
                return error
            yandex_folder_id, error = get_tenant_api_key(tenant_id, 'yandex', 'folder_id')
            if error:
                return error
            
            completion_options = {
                'temperature': ai_temperature,
                'maxTokens': ai_max_tokens
            }
            
            yandex_response = requests.post(
                'https://llm.api.cloud.yandex.net/foundationModels/v1/completion',
                headers={
                    'Authorization': f'Api-Key {yandex_api_key}',
                    'Content-Type': 'application/json'
                },
                json={
                    'modelUri': f'gpt://{yandex_folder_id}/{chat_api_model}/latest',
                    'completionOptions': completion_options,
                    'messages': [
                        {'role': 'system', 'text': system_prompt},
                        {'role': 'user', 'text': user_message}
                    ]
                }
            )
            yandex_data = yandex_response.json()
            assistant_message = yandex_data['result']['alternatives'][0]['message']['text']
            
            # –õ–æ–≥–∏—Ä—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ GPT
            usage_data = yandex_data.get('result', {}).get('usage', {})
            total_tokens = usage_data.get('totalTokens', 0)
            # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ int –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –ø—Ä–∏—à–ª–∞ —Å—Ç—Ä–æ–∫–∞
            try:
                total_tokens = int(total_tokens) if total_tokens else 0
            except (ValueError, TypeError):
                total_tokens = 0
            if total_tokens > 0:
                log_token_usage(
                    tenant_id=tenant_id,
                    operation_type='gpt_response',
                    model=chat_api_model,
                    tokens_used=total_tokens,
                    request_id=session_id
                )
        elif ai_provider == 'openrouter':
            openrouter_key, error = get_tenant_api_key(tenant_id, 'openrouter', 'api_key')
            if error:
                return error
            
            # –î–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å, –¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞–ø—Ä—è–º—É—é
            free_models = [
                'llama-3.3-70b', 'gemini-2.0-flash', 'deepseek-v3', 'deepseek-r1',
                'llama-3.1-405b', 'qwen-2.5-72b', 'mistral-small', 'phi-3-medium',
                'llama-3.1-8b', 'gemma-2-9b', 'qwen-2.5-7b'
            ]
            
            if chat_api_model.endswith(':free') or any(chat_api_model.startswith(m) for m in free_models):
                try:
                    working_model = get_working_free_model(chat_api_model)
                    print(f"üîÑ OpenRouter –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –º–æ–¥–µ–ª—å: {chat_api_model} ‚Üí {working_model}")
                except Exception as model_error:
                    return {
                        'statusCode': 400,
                        'headers': {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
                        'body': json.dumps({'error': f'–ú–æ–¥–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞: {str(model_error)}'}),
                        'isBase64Encoded': False
                    }
            else:
                # –ü–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞–ø—Ä—è–º—É—é
                working_model = chat_api_model
                print(f"üí∞ OpenRouter –ø–ª–∞—Ç–Ω–∞—è –º–æ–¥–µ–ª—å: {chat_api_model}")
            
            chat_client = OpenAI(
                api_key=openrouter_key,
                base_url="https://openrouter.ai/api/v1"
            )
            response = chat_client.chat.completions.create(
                model=working_model,
                messages=[
                    {"role": "system", "content": system_prompt},
                    {"role": "user", "content": user_message}
                ],
                temperature=ai_temperature,
                top_p=ai_top_p,
                frequency_penalty=ai_frequency_penalty,
                presence_penalty=ai_presence_penalty,
                max_tokens=ai_max_tokens
            )
            assistant_message = response.choices[0].message.content
        elif ai_provider == 'deepseek':
            deepseek_key, error = get_tenant_api_key(tenant_id, 'deepseek', 'api_key')
            if error:
                return error
            chat_client = OpenAI(
                api_key=deepseek_key,
                base_url="https://api.deepseek.com"
            )
            response = chat_client.chat.completions.create(
                model=chat_api_model,
                messages=[
                    {"role": "system", "content": system_prompt},
                    {"role": "user", "content": user_message}
                ],
                temperature=ai_temperature,
                top_p=ai_top_p,
                frequency_penalty=ai_frequency_penalty,
                presence_penalty=ai_presence_penalty,
                max_tokens=ai_max_tokens
            )
            assistant_message = response.choices[0].message.content
        elif ai_provider == 'proxyapi':
            proxyapi_key, error = get_tenant_api_key(tenant_id, 'proxyapi', 'api_key')
            if error:
                return error
            chat_client = OpenAI(
                api_key=proxyapi_key,
                base_url="https://api.proxyapi.ru/openai/v1"
            )
            response = chat_client.chat.completions.create(
                model=chat_api_model,
                messages=[
                    {"role": "system", "content": system_prompt},
                    {"role": "user", "content": user_message}
                ],
                temperature=ai_temperature,
                top_p=ai_top_p,
                frequency_penalty=ai_frequency_penalty,
                presence_penalty=ai_presence_penalty,
                max_tokens=ai_max_tokens
            )
            assistant_message = response.choices[0].message.content
        else:
            return {
                'statusCode': 400,
                'headers': {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
                'body': json.dumps({'error': f'–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä: {ai_provider}'}),
                'isBase64Encoded': False
            }

        cur.execute("""
            INSERT INTO t_p56134400_telegram_ai_bot_pdf.chat_messages (session_id, role, content, tenant_id)
            VALUES (%s, %s, %s, %s)
        """, (session_id, 'assistant', assistant_message, tenant_id))
        conn.commit()

        cur.close()
        conn.close()

        return {
            'statusCode': 200,
            'headers': {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
            'body': json.dumps({
                'message': assistant_message,
                'sessionId': session_id,
                'debug': {
                    'context_ok': context_ok,
                    'gate_reason': gate_reason,
                    'gate_info': gate_debug
                }
            }),
            'isBase64Encoded': False
        }

    except Exception as e:
        return {
            'statusCode': 500,
            'headers': {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
            'body': json.dumps({'error': str(e)}),
            'isBase64Encoded': False
        }